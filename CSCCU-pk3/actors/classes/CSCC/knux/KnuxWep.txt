actor KnuxNoBubble : Once {}

actor BubbleArrowBoss : Weapon
{
Obituary "%o was sabotaged by %k's Bubble Arrow."
Weapon.AmmoUse 0
Weapon.AmmoGive 0
weapon.ammotype "KnuxAmmo"
Weapon.AmmoUse2 0
Weapon.AmmoGive2 0
weapon.ammotype2 "KnuxAmmo2"
+WEAPON.AMMO_OPTIONAL
+WEAPON.DONTBOB
+WEAPON.CHEATNOTWEAPON
dropitem "BubbleArrowWepGiver"
obituary "%o was cleaned up by %k's Bubble Arrow."
States
{
Spawn:
TNT1 A 1
stop
Deselect:
TNT1 A 0 A_SelectWeapon("ReselectBubbleArrowBoss")
TNT1 AAAAAAAAAAAAAAAAAAAAAA 0 A_Lower
TNT1 A 1 A_Lower
Loop
Select:
TNT1 AAAAAAAAAAAAAAAAAAAAAA 0 A_Raise
TNT1 A 1 A_Raise
Loop

Ready:
TNT1 A 0 A_JumpIfInventory("Once",1,"Ready2")
TNT1 A 0 A_GiveInventory("Once",1)
TNT1 A 0 ACS_ExecuteAlways(991,0,WCCS_KNUX)
Ready2:
BBOW A 0 A_JumpIfInventory("KnuxAmmo",240,"Ready3")
BBOW A 1 A_WeaponReady(WRF_NOSECONDARY)
BBOW A 0 A_GiveInventory("KnuxAmmoPickup",1)
loop
Ready3:
BBOW A 1 A_WeaponReady
BBOW A 0 A_GiveInventory("KnuxAmmoPickup",1)
loop
Fire:
BBOW BCD 3
Hold:
TNT1 A 0 A_JumpIfInventory("IsBot", 1, "BotCheck1")
TNT1 A 0 A_JumpIfInventory("KnuxCharge",60,"Hold3")
TNT1 A 0 A_GiveInventory("KnuxCharge",1)
TNT1 A 0 A_JumpIfInventory("KnuxCharge",30,"Hold2")
BBOW E 1 A_GiveInventory("KnuxAmmoBowPrimePickup",1)
BBOW E 0 A_Refire
Goto Fire1

Fire1:
BBOW H 0 A_TakeInventory("KnuxCharge",999)
BBOW H 0 A_PlaySoundEx("weapon/pshot","Weapon")
BBOW H 0 A_FireCustomMissile("BubbleArrow",0,0,8,0)
BBOW H 10
BBOW IIIIIIIIIII 1 A_GiveInventory("KnuxAmmoBowPrimePickup",1)
goto Ready2
Hold2:
BBOW F 1 A_GiveInventory("KnuxAmmoBowPrimePickup",1)
BBOW F 0 A_Refire
Goto Fire2
Fire2:
BBOW H 0 A_TakeInventory("KnuxCharge",999)
BBOW H 0 A_PlaySoundEx("weapon/pshot","Weapon")
BBOW H 0 A_FireCustomMissile("BubbleArrow2",0,0,8,0)
BBOW H 10
BBOW IIIIIIIIIII 1 A_GiveInventory("KnuxAmmoBowPrimePickup",1)
goto Ready2
Hold3:
BBOW G 1 A_GiveInventory("KnuxAmmoBowPrimePickup",1)
BBOW G 0 A_Refire
goto Fire3
Fire3:
BBOW H 0 A_TakeInventory("KnuxCharge",999)
BBOW H 0 A_PlaySoundEx("weapon/pshot","Weapon")
BBOW H 0 A_FireCustomMissile("BubbleArrow3",0,0,8,0)
BBOW H 10
BBOW IIIIIIIIIII 1 A_GiveInventory("KnuxAmmoBowPrimePickup",1)
goto Ready2
BotCheck1:
BBOW H 0 A_Jump(16, 1)
Goto Hold+1
TNT1 A 0 A_JumpIfInventory("KnuxCharge",60,"BotCheck3")
TNT1 A 0 A_JumpIfInventory("KnuxCharge",30,"BotCheck2")
TNT1 A 0 A_Jump(64, "AltFire")
Goto Fire1
BotCheck2:
BBOW H 0 A_Jump(16, "Fire2")
Goto Hold2
BotCheck3:
BBOW H 0 A_Jump(192, "Fire3")
Goto Hold3
AltFire:
BBOW I 0 A_TakeInventory("KnuxAmmo",240)
BBOW I 2 
BBOW J 2 A_GunFlash
BBOW K 15 
BBOW KJI 3
goto Ready2
Flash:
BBO2 AB 2
BBO2 B 0 A_PlaySoundEx("weapon/oilshot","Weapon")
BBO2 C 10 A_SpawnItemEx("KnuxBouncer", 0, 8, 16, cos(-pitch)*20, 0, sin(-pitch)*20, 0, SXF_TRANSFERTRANSLATION) 
BBO2 BA 2
stop
NoAmmo:
TNT1 A 0
goto Ready2
}
}

actor ReselectBubbleArrowBoss : Weapon
{
//Weapon.SlotNumber 1
states
{
Spawn:
TNT1 A 0
stop
Ready:
Fire:
Select:
Deselect:
TNT1 A 0 A_JumpIfInventory("BubbleArrowBoss", 1, "Reselect")
TNT1 A 0 A_TakeInventory("ReselectBubbleArrowBoss",1)
TNT1 A 1
loop
Reselect:
TNT1 A 0 A_SelectWeapon("BubbleArrowBoss")
TNT1 AAAAAAAAAAAAAAAAAAAAAA 0 A_Lower
TNT1 A 1 A_Lower
Loop
}
}

actor KnuxAmmo : Ammo
{
+INVENTORY.IGNORESKILL
inventory.amount 1
inventory.maxamount 480
}
actor KnuxAmmo2 : KnuxAmmo
{
inventory.maxamount 640
}

actor KnuxAmmoBowPrimePickup : CustomInventory
{
states
{
Pickup:
TNT1 A 0 A_GiveInventory("KnuxAmmo",1)

TNT1 A 0 A_JumpIfInventory("KnuxMineItem",6,"Full")
TNT1 A 0 A_JumpIfInventory("KnuxAmmo2",640,"GiveMine")
TNT1 A 0 A_GiveInventory("KnuxAmmo2",1)
stop
GiveMine:
TNT1 A 0 A_TakeInventory("KnuxAmmo2",640)
TNT1 A 0 A_GiveInventory("KnuxMineItem",1)
stop
Full:
TNT1 A 0
stop
}
}

actor KnuxAmmoPickup : CustomInventory
{
states
{
Pickup:
TNT1 A 0 A_GiveInventory("KnuxAmmo",2)

TNT1 A 0 A_JumpIfInventory("KnuxMineItem",6,"Full")
TNT1 A 0 A_JumpIfInventory("KnuxAmmo2",639,"GiveMine")
TNT1 A 0 A_GiveInventory("KnuxAmmo2",2)
stop
GiveMine:
TNT1 A 0 A_TakeInventory("KnuxAmmo2",639)
TNT1 A 0 A_GiveInventory("KnuxMineItem",1)
stop
Full:
TNT1 A 0
stop
}
}

actor KnuxCharge : Inventory
{
inventory.amount 1
inventory.maxamount 60
}

actor Sticky : Inventory
{
inventory.amount 1
inventory.maxamount 1
}

actor Detonated : Sticky {}

actor BubbleArrow
{
Obituary "%o was sabotaged by %k's Bubble Arrow."
PROJECTILE
+FORCEXYBILLBOARD
//+DONTBLAST
damagetype "BubbleArrow"
Speed 40
Damage (5)
radius 12
height 8
scale 2.5
States
{
Spawn:
BARW A 5
BARW A 0 A_SpawnItemEx("BubbleArrowTrailS", 0, 0, 0, Random(-1, 1), Random(-1, 1), Random(1, 3))
Loop
XDeath:
TNT1 A 0 A_PlaySoundEx("weapon/crackerexplode", "Weapon")
TNT1 A 0 A_Explode(30, 128, 0)
Goto Death+2
Death:
TNT1 A 0 A_PlaySoundEx("weapon/crackerexplode", "Weapon")
TNT1 A 0 A_Explode(30, 128, 1)
TNT1 A 0 A_Stop
NAPA EFGHIJKLMNOPQRS 1
stop
}
}

actor BubbleArrow2 : BubbleArrow
{
damagetype "BubbleArrow2"
+HEXENBOUNCE
-ALLOWBOUNCEONACTORS
+DONTBLAST
//-BOUNCEONFLOORS
BounceFactor 0.91
WallBounceFactor 0.91
Bouncecount 2
Speed 50
states
{
Spawn:
BARW B 4 
BARW B 0  A_SpawnItemEx("BubbleArrowTrailS", 0, 0, 0, Random(-1, 1), Random(-1, 1), Random(1, 3))
Loop
XDeath:
TNT1 A 0 A_PlaySoundEx("weapon/crackerexplode", "Weapon")
TNT1 A 0 A_Explode(40, 128, 0)
Goto Death+2
Death:
TNT1 A 0 A_PlaySoundEx("weapon/crackerexplode", "Weapon")
TNT1 A 0 A_Explode(40, 128, 1)
TNT1 A 0 A_Stop
NAPA EFGHIJKLMNOPQRS 1
stop
}
}

actor BubbleArrow3 : BubbleArrow
{
damagetype "BubbleArrow3"
Speed 65
states
{
Spawn:
BARW C 2
BARW C 0 A_SpawnItemEx("BubbleArrowTrail", 0, 0, 0, Random(-1, 1), Random(-1, 1), Random(1, 3))
Loop
Death:
BARW C 0 A_PlaySound("weapon/crashland")
BARW CCCCCCCCCC 1
BARW CCCCCCCCCC 1
BARW CCCCCCCCCC 1
Goto Detonate
XDeath:
TNT1 A 0 A_PlaySoundEx("weapon/crackerexplode", "Weapon")
TNT1 A 0 A_Explode(50, 128, 0)
Goto Detonate+2
Detonate:
TNT1 A 0 A_PlaySoundEx("weapon/crackerexplode", "Weapon")
TNT1 A 0 A_Explode(60, 128, 1)
TNT1 A 0 A_Stop
NAPA EFGHIJKLMNOPQRS 1
stop
}
}

actor BubbleArrow4 : BubbleArrow
{
damagetype "BubbleArrowSplit"
states
{
XDeath:
TNT1 A 0 A_PlaySoundEx("weapon/crackerexplode", "Weapon")
TNT1 A 0 A_Explode(10, 128, 0)
Goto Death+2
Death:
TNT1 A 0 A_PlaySoundEx("weapon/crackerexplode", "Weapon")
TNT1 A 0 A_Explode(10, 128, 1)
TNT1 A 0 A_Stop
NAPA EFGHIJKLMNOPQRS 1
stop
}
}
actor BubbleArrow5 : BubbleArrow2
{
damagetype "BubbleArrowSplit"
states
{
XDeath:
TNT1 A 0 A_PlaySoundEx("weapon/crackerexplode", "Weapon")
TNT1 A 0 A_Explode(15, 128, 0)
Goto Death+2
Death:
TNT1 A 0 A_PlaySoundEx("weapon/crackerexplode", "Weapon")
TNT1 A 0 A_Explode(15, 128, 1)
TNT1 A 0 A_Stop
NAPA EFGHIJKLMNOPQRS 1
stop
}
}
actor BubbleArrow6 : BubbleArrow3
{
damagetype "BubbleArrowSplit"
states
{
XDeath:
TNT1 A 0 A_PlaySoundEx("weapon/crackerexplode", "Weapon")
TNT1 A 0 A_Explode(20, 128, 0)
Goto Detonate+2
Detonate:
TNT1 A 0 A_PlaySoundEx("weapon/crackerexplode", "Weapon")
TNT1 A 0 A_Explode(20, 128, 1)
TNT1 A 0 A_Stop
NAPA EFGHIJKLMNOPQRS 1
stop
}
}  
/*
actor PowerKnuxRebound : PowerProtection
{
Powerup.Duration 35
damagefactor "normal", 1.0
damagefactor "KnuxRebound", 0.0
}

actor PowerKnuxRebound2 : PowerKnuxRebound
{
Powerup.Duration 5
}
*/

actor KnuxBouncer
{
//PROJECTILE
+MISSILE
+NOGRAVITY
//+NOTARGETSWITCH
+QUICKTORETALIATE
radius 35
height 70
damagetype "KnuxRebound"
damage (0)
+GHOST
+DOOMBOUNCE
+SHOOTABLE
+INVULNERABLE
Health 100
+REFLECTIVE
+SHIELDREFLECT
+RIPPER
+NORADIUSDMG
+NODAMAGETHRUST
+FORCEYBILLBOARD
+DONTRIP
+DONTBLAST
scale 4.0
Mass 9999999
speed 20
PainChance "BubbleArrow", 255
PainChance "BubbleArrow2", 255
PainChance "BubbleArrow3", 255
PainChance 255

reactiontime 600
//obituary "%o was rejected by %k's Bubble Bouncer."	
obituary "%o was rejected by %p own attack!"
States
{
Spawn:
BARW F 0
BARW F 0 A_SetArg(1,ACS_ExecuteWithResult(257))
BARW F 0 A_SetArg(0, 0)
BAWW F 0 A_GiveToTarget("KnuxNoBubble", 1)
//BARW F 0 A_TransferPointer(AAPTR_DEFAULT, AAPTR_DEFAULT, AAPTR_TARGET, AAPTR_TRACER)
BARW F 0 A_RearrangePointers(AAPTR_DEFAULT, AAPTR_DEFAULT, AAPTR_TARGET)
BARW FFFFFFFFFF 1 ACS_ExecuteAlways(247,0,-10,48, 1)
BARW FF 1 A_Stop
BARW F 0 A_ChangeFlag("FLOATBOB", 1)
BARW F 0 Thing_ChangeTID(0, Args[1] - 100)
BARW F 0 A_ChangeFlag("INVULNERABLE", 0)
BAWW F 0 A_TakeFromTarget("KnuxNoBubble", 1)
Goto Spawn2
Spawn2:
//BARW F 0 A_TransferPointer(AAPTR_DEFAULT, AAPTR_DEFAULT, AAPTR_TRACER, AAPTR_TARGET)
BARW F 0 A_RearrangePointers(AAPTR_TRACER, AAPTR_DEFAULT, AAPTR_DEFAULT)
BARW F 1 A_SetArg(0, Args[0]+1)
BARW F 0 ACS_ExecuteAlways(259, 0, 1)
BARW F 0 ACS_ExecuteAlways(247,0,-10,48, 1)
BARW F 0 A_JumpIf(Args[0] >= 300, "Death")//A_Countdown
BARW F 0 A_JumpIfInTargetInventory("KnuxNoBubble", 1, "Death")
BARW F 0 A_JumpIfInTargetInventory("IsDead", 1, "Death")
loop
Pain.BubbleArrow:
BARW F 1
BARW F 0 A_JumpIf(Args[1] != ACS_ExecuteWithResult(257), "Spawn2")
BARW F 2 ACS_ExecuteAlways(259, 0, 1)
BARW F 0 A_ChangeFlag("THRUACTORS", 1)
BARW F 0 A_Fadeout(0.5)
BARW F 0 A_CustomMissile("BubbleArrow4",32+sin(-pitch)*48,0,0,CMF_AIMDIRECTION, -pitch) 
BARW F 0 A_CustomMissile("BubbleArrow4",32+sin(-pitch)*48,0,5,CMF_AIMDIRECTION, -pitch) 
BARW F 0 A_CustomMissile("BubbleArrow4",32+sin(-pitch)*48,0,-5,CMF_AIMDIRECTION, -pitch) 
BARW F 0 A_CustomMissile("BubbleArrow4",32+sin(-pitch)*48,0,-10,CMF_AIMDIRECTION, -pitch) 
BARW F 5 A_CustomMissile("BubbleArrow4",32+sin(-pitch)*48,0,10,CMF_AIMDIRECTION, -pitch) 
BARW F 0 A_ChangeFlag("THRUACTORS", 0)
BARW F 0 A_Fadein(0.5)
Goto Spawn2
Pain.BubbleArrow2:
BARW F 1
BARW F 0 A_JumpIf(Args[1] != ACS_ExecuteWithResult(257), "Spawn2")
BARW F 2 ACS_ExecuteAlways(259, 0, 1)
BARW F 0 A_ChangeFlag("THRUACTORS", 1)
BARW F 0 A_Fadeout(0.5)
BARW F 0 A_CustomMissile("BubbleArrow5",32+sin(-pitch)*48,0,0,CMF_AIMDIRECTION, -pitch) 
BARW F 0 A_CustomMissile("BubbleArrow5",32+sin(-pitch)*48,0,5,CMF_AIMDIRECTION, -pitch) 
BARW F 0 A_CustomMissile("BubbleArrow5",32+sin(-pitch)*48,0,-5,CMF_AIMDIRECTION, -pitch) 
BARW F 0 A_CustomMissile("BubbleArrow5",32+sin(-pitch)*48,0,-10,CMF_AIMDIRECTION, -pitch) 
BARW F 5 A_CustomMissile("BubbleArrow5",32+sin(-pitch)*48,0,10,CMF_AIMDIRECTION, -pitch) 
BARW F 0 A_ChangeFlag("THRUACTORS", 0)
BARW F 0 A_Fadein(0.5)
Goto Spawn2
Pain.BubbleArrow3:
BARW F 1
BARW F 0 A_JumpIf(Args[1] != ACS_ExecuteWithResult(257), "Spawn2")
BARW F 2 ACS_ExecuteAlways(259, 0, 1)
BARW F 0 A_ChangeFlag("THRUACTORS", 1)
BARW F 0 A_Fadeout(0.5)
BARW F 0 A_CustomMissile("BubbleArrow6",32+sin(-pitch)*48,0,0,CMF_AIMDIRECTION, -pitch) 
BARW F 0 A_CustomMissile("BubbleArrow6",32+sin(-pitch)*48,0,5,CMF_AIMDIRECTION, -pitch) 
BARW F 0 A_CustomMissile("BubbleArrow6",32+sin(-pitch)*48,0,-5,CMF_AIMDIRECTION, -pitch) 
BARW F 0 A_CustomMissile("BubbleArrow6",32+sin(-pitch)*48,0,-10,CMF_AIMDIRECTION, -pitch) 
BARW F 5 A_CustomMissile("BubbleArrow6",32+sin(-pitch)*48,0,10,CMF_AIMDIRECTION, -pitch) 
BARW F 0 A_ChangeFlag("THRUACTORS", 0)
BARW F 0 A_Fadein(0.5)
Goto Spawn2
Pain:
BARW F 0 A_TransferPointer(AAPTR_DEFAULT, AAPTR_DEFAULT, AAPTR_TRACER, AAPTR_TARGET)
Goto Spawn2
Death:
BARW G 3
stop
}
}

actor KnuxMineItem : CustomInventory
{
inventory.amount 1
inventory.maxamount 6
inventory.icon "KnuxIcon"
+INVBAR
+INVENTORY.KEEPDEPLETED
states
{
Spawn:
TNT1 A 0
stop
Use:
TNT1 A 0 A_CheckFloor("Use2")
fail
Use2:
TNT1 A 0 A_SpawnItemEx("KnuxMine",30,0,10)
stop
}
}

actor KnuxMine
{
PROJECTILE
+FLOORHUGGER
damagetype "KnuxMine"
damage(0)
scale 2.5
reactiontime 700
+RIPPER
+THRUGHOST
-NOGRAVITY
radius 8
height 12
//PainChance 255
obituary "%o was blown out of the water by %k's Splash Mine."
States
{
Spawn:
BARW H 0
BARW H 0 A_PlaySound("weapon/crashland")
BARW HI 3
BARW H 0 A_ChangeFlag("RIPPER",0)
BARW H 0 A_ChangeFlag("THRUGHOST",0)
BARW H 0 A_ChangeFlag("FLOORHUGGER", 0)
Spawn2:
BARW I 0 A_JumpIfCloser(22,"Death")
BARW I 1 A_CountDown
loop
Death:
TNT1 A 0 A_PlaySoundEx("weapon/crackerexplode", "Weapon")
TNT1 A 0 A_Explode(30, 100, 0)
TNT1 A 0 A_Explode(15, 100, 1)
NAPA EFGHIJKLMNOPQRS 1
stop
}
}

actor KnuxMineShot //For Later
{
PROJECTILE
-NOGRAVITY
scale 2.5
radius 8
height 12
Speed 15
obituary "%o was blown out of the water by %k's Splash Mine."
states
{
spawn:
BARW I 0
BARW I 0 ThrustThingZ(0, 35, 0, 1)
Goto Spawn2
Spawn2:
BARW I 3
loop
Death:
TNT1 A 0 A_PlaySoundEx("weapon/crackerexplode", "Weapon")
TNT1 A 0 A_Explode(45, 100, 1)
NAPA EFGHIJKLMNOPQRS 1
stop
}
}

actor PowerKnuxMine : PowerProtection
{
Powerup.Duration 2
damagefactor "normal", 1.0
damagefactor "KnuxMine", 0.0
}


actor BubbleArrowTrail
{
scale 2.5
-SOLID
+NOGRAVITY
+CLIENTSIDEONLY
height 0
radius 0
States
{
Spawn:
TNT1 A 2
BARW D 10 
Death:
BARW E 3
stop
}
}

actor BubbleArrowTrailS : BubbleArrowTrail
{
States
{
Spawn:
TNT1 A 2
BUBS E 10
Goto Death
}
}