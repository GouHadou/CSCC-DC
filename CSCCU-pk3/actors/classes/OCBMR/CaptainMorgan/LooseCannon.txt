
//[+]========================================================================[+]
//--------------------------------|Loose Cannon|--------------------------------
//[+]========================================================================[+]
//Inspired by the Team Fortress 2 weapon of the same name, the Loose Cannon fires
//cannonball's with fuses set to explode after 1 second. but can be primed to 
//explode sooner. the key gimmick with the weapon is the fact that it knocks
//victims away upon contact, and if you can get the bomb to strike someone and
//then explode, you will achieve a "Double donk", which is a type of critical
//hit that deals amplified damage.
//[+]========================================================================[+]

actor CaptLooseCannonWep : Weapon
{
Weapon.AmmoUse1 1
Weapon.AmmoGive1 4
//Weapon.AmmoUse2 1
//Weapon.AmmoGive2 4
Weapon.SlotNumber 1
Weapon.KickBack 300
Obituary "%o was blasted by %k."
Inventory.Pickupmessage ""
weapon.ammotype1 "CaptLooseCannonAmmo"
//weapon.ammotype2 "CaptTinyBombAmmo"
Inventory.icon "BOMBSI"
+WEAPON.AMMO_OPTIONAL
+WEAPON.ALT_AMMO_OPTIONAL
+WEAPON.DONTBOB
+WEAPON.CHEATNOTWEAPON
+WEAPON.NOAUTOAIM
scale 2.0
States
{
Ready:
PRMI A 0 A_GunFlash
PRMI A 0 ACS_ExecuteAlways(998,0,3)
PRMI A 2 A_WeaponReady
PRMI A 3 A_WeaponReady
Goto Ready+2
Weaponlock:
PRMI A 1 A_WeaponReady(WRF_NOSWITCH)
loop
Deselect:
TNT1 AAAAAAAAAAAAAAAAAAAAAA 0 A_Lower
PRMI A 1 A_Lower
Loop
Select:
TNT1 AAAAAAAAAAAAAAAAAAAAAA 0 A_Raise
PRMI A 1 A_Raise
Loop
Fire:
//BLTR B 0 A_WeaponReady(WRF_NOSWITCH)
PRMI B 1  A_JumpIfNoAmmo("NoAmmo")
PRMI B 0 //A_GiveInventory("2Soon2Switch")
PRMI B 0 A_GiveInventory("FusestartDelay",1)
PRMI B 1 A_Jumpifinventory("FusestartDelay",5,"Fuseon")
PRMI B 0 A_Refire
PRMI C 1 A_JumpIfInventory("CaptLooseCannonTimer",5,"Fire1") //30 tic bomb
PRMI C 0 A_PlaySoundEx("weapon/powerstone","Weapon")
PRMI C 2 A_FireCustomMissile("CaptLooseCannonBall",0,1,0,2)
Goto Afterfire
FuseOn:
PRMI B 0 A_JumpIfInventory("CaptLooseCannonTimer",35,"SelfDestruct")
PRMI B 1 A_GiveInventory("CaptLooseCannonTimer",1)
PRMI B 0 A_PlaySoundEX("weapon/waterwave","Voice")
PRMI B 0 A_Refire("FuseOn")
PRMI B 1 A_JumpIfInventory("CaptLooseCannonTimer",30,"Fire1") //5 Tic bomb
PRMI B 1 A_JumpIfInventory("CaptLooseCannonTimer",25,"Fire2") //10 Tic bomb
PRMI B 1 A_JumpIfInventory("CaptLooseCannonTimer",20,"Fire3") //15 Tic bomb
PRMI B 1 A_JumpIfInventory("CaptLooseCannonTimer",15,"Fire4") //20 Tic bomb
PRMI B 1 A_JumpIfInventory("CaptLooseCannonTimer",10,"Fire5") //25 Tic bomb
PRMI B 1 A_JumpIfInventory("CaptLooseCannonTimer",5,"Fire6")  //30 Tic bomb
// ---Otherwise, launch too soon, just launch a normal 35 sec one---
PRMI C 0 A_StopsoundEx("Voice")
PRMI C 1 A_JumpIfInventory("CaptLooseCannonTimer",5,"Fire1") //30 tic bomb
PRMI C 0 A_PlaySoundEx("weapon/powerstone","Weapon")
PRMI C 2 A_GiveInventory("LCBShooter",1)
Goto Afterfire
Fire1:
PRMI C 1 A_JumpIfInventory("CaptLooseCannonTimer",10,"Fire2") //25 tic bomb
PRMI C 0 A_PlaySoundEx("weapon/powerstone","Weapon")
PRMI C 2 A_GiveInventory("LCB_30TShooter",1)
PRMI C 0 A_TakeInventory("CaptLooseCannonTimer",99)
Goto Afterfire
Fire2:
PRMI C 1 A_JumpIfInventory("CaptLooseCannonTimer",15,"Fire3") //20 tic bomb
PRMI C 0 A_PlaySoundEx("weapon/powerstone","Weapon")
PRMI C 2 A_GiveInventory("LCB_25TShooter",1)
Goto Afterfire
Fire3:
PRMI C 1 A_JumpIfInventory("CaptLooseCannonTimer",20,"Fire4") //15 tic bomb
PRMI C 0 A_PlaySoundEx("weapon/powerstone","Weapon")
PRMI C 2 A_GiveInventory("LCB_20TShooter",1)
Goto Afterfire
Fire4:
PRMI C 1 A_JumpIfInventory("CaptLooseCannonTimer",25,"Fire5") //10 tic bomb
PRMI C 0 A_PlaySoundEx("weapon/powerstone","Weapon")
PRMI C 2 A_GiveInventory("LCB_15TShooter",1)
Goto Afterfire
Fire5:
PRMI C 1 A_JumpIfInventory("CaptLooseCannonTimer",30,"Fire6") //5 tic bomb
PRMI C 0 A_PlaySoundEx("weapon/powerstone","Weapon")
PRMI C 2 A_GiveInventory("LCB_10TShooter",1)
Goto Afterfire
Fire6:
PRMI C 0 A_PlaySoundEx("weapon/powerstone","Weapon")
PRMI C 2 A_GiveInventory("LCB_5TShooter",1)
Goto Afterfire
AfterFire:
PRMI D 0 A_TakeInventory("CaptLooseCannonTimer",99)
PRMI D 0// A_TakeInventory("LCFuseFlag",9)
PRMI B 0 A_TakeInventory("FusestartDelay",10)
PRMI BA 17
Goto Ready+2
//[+]----------[+]
/*
Altfire:
PRMI A 0 A_JumpIfNoAmmo("NoAmmo")
PRMI C 0 A_PlaySoundEx("weapon/powerstone","Weapon")
PRMI A 0 A_TakeInventory("CaptTinyBombAmmo",1)
PRMI CC 1 A_FireCustomMissile("CaptTinyBomb",random(0,20),0)
PRMI CC 1 A_FireCustomMissile("CaptTinyBomb",random(359,330),0)
PRMI C 1 A_FireCustomMissile("CaptTinyBomb",0,0)
PRMI BA 8
Goto Weaponlock*/
Flash:
//TNT1 A 0 A_JumpIfInventory("CaptLooseCannonTimer",35,"SelfDestruct")
TNT1 A 1 //A_JumpIfInventory("LCFuseFlag",1,8) //5
TNT1 A 0// A_JumpIfInventory("2Soon2Switch",1,6) //2
TNT1 A 70
TNT1 A 0 A_JumpIfInventory("CaptLooseCannonAmmo",4,2)
TNT1 A 0 A_GiveInventory("CaptLooseCannonAmmo",1)
TNT1 A 0 A_JumpIfInventory("CaptTinyBombAmmo",4,2)
TNT1 A 0 A_GiveInventory("CaptTinyBombAmmo",1)
TNT1 AA 1
loop
SelfDestruct:
PRMI A 1 A_SpawnitemEx("CaptLooseCannonBlast")  //Self destruct
PRMI A 0 damagething(100)  
PRMI A 0 //A_TakeInventory("LCFuseFlag",9)
PRMI A 0 A_TakeInventory("CaptLooseCannonAmmo",1)
PRMI A 0 A_TakeInventory("CaptLooseCannonTimer",99)
PRMI A 0 ThrustThingZ(0,80,0,1)
PRMI A 8
SelfDestructStaller:
PRMI A 1
PRMI A 0 A_Refire("SelfDestructStaller")
Goto Ready+2
NoAmmo:
PRMI A 1
PRMI A 1 //ACS_Execute(979,0)
Goto Ready+2
}
}
/*
actor LCFuseFlag: Inventory
{
inventory.amount 1
inventory.maxamount 9
}*/

actor CaptLooseCannonBall   
{
+SOLID
PROJECTILE
-BLOODSPLATTER
+DONTBLAST
-NOGRAVITY
-NOINTERACTION
+BOUNCEONWALLS
+BOUNCEONCEILINGS
+BOUNCEONFLOORS
//+HEXENBOUNCE
//+NOBLOCKMAP
Radius 30
Height 45
speed 64
//Mass 999999
Bouncefactor 0.3
Wallbouncefactor 0.2
damage(10)  
//this makes it so the bomb deals no damage when it is on the ground and idle. 
//estimate max damage is ~80
Obituary "%o got donked by %k's Loose Cannonball!."
damagetype "LooseCannon"  //Normal type + Thrust [check classbase for -Ehibika-]
gravity 2.0
scale 2.0
Reactiontime 35
States
{
Spawn:
BOMB S 0
BOMB S 1 ThrustThingZ(0, 32, 0, 1)
BOMB S 1 A_Countdown
BOMB S 0 A_PlaySoundEX("weapon/waterwave","Voice")
BOMB S 0 A_checkfloor("Harmless")
Goto Spawn+2
Harmless:
//BOMB S 1 A_Countdown
BOMB S 0 A_Changeflag("THRUACTORS",1)
BOMB S 0 A_ScaleVelocity(0.6)
Goto Spawn+2
Crash: 
BOMB S 1
BOMB S 0 A_Recoil(-20)
Goto Spawn+2
Death:
BOMB S 0 A_Stop
BOMB S 0 A_PlaySoundEx("weapon/hyperbomb", "Weapon")
BOMB S 0 A_ChangeFlag("NOGRAVITY",1)
BOMB S 0 A_SpawnitemEx("CaptLooseCannonBlast")
//BOMB S 0 A_Explode(200, 180, 0)
//SLVB BCDEFGHIJKLMNOPQR 1 
stop
}
}

actor CaptLooseCannonBall_30T : CaptLooseCannonBall
{ReactionTime 30}

actor CaptLooseCannonBall_25T : CaptLooseCannonBall
{ReactionTime 25}

actor CaptLooseCannonBall_20T : CaptLooseCannonBall
{ReactionTime 20}

actor CaptLooseCannonBall_15T : CaptLooseCannonBall
{ReactionTime 15}

actor CaptLooseCannonBall_10T : CaptLooseCannonBall
{ReactionTime 10}

actor CaptLooseCannonBall_5T : CaptLooseCannonBall
{ReactionTime 5}

Actor CaptLooseCannonBlast
{
PROJECTILE
+NOINTERACTION
speed 0
Damage (0)
DamageType "LooseCannonExpl"  //Fire type + Thrust
Scale 5.5
States
{
Spawn:
ASEX A 0
ASEX A 0 A_Explode(15, 300, 0,0,200)
ASEX ABCDEF 1 //A_Explode(250, 180, 0,0,50)
stop
}
}


actor FusestartDelay : Inventory // determines how long you must hold to light the fuse
{
inventory.amount 1
inventory.maxamount 10
}

actor CaptLooseCannonTimer : Inventory // determines how long you held the bomb
{
inventory.amount 1
inventory.maxamount 35
}

actor CaptLooseCannonAmmo : Ammo 
{
inventory.amount 1
inventory.maxamount 4
}

actor CaptTinyBombAmmo : Ammo 
{
inventory.amount 1
inventory.maxamount 4
}


actor DoubleDonkable : PowerProtection 
{
powerup.duration 17
damagefactor "LooseCannonExpl", 2.50 
}

Actor DoubleDonkIcon
{
PROJECTILE
+NOINTERACTION
+FORCEXYBILLBOARD
speed 0
Damage (0)
ReactionTime 35
Scale 2
States
{
Spawn:
DONK A 1 A_countdown
//DONK A 1 ThrustThingZ(0,10,0,0)
loop
Death:
DONK AAAAAAAAAAA 5 A_fadeout(0.09)
stop
}
}


actor LCBShooter : CustomInventory 
{
inventory.amount 1
Inventory.MaxAmount 100
+AUTOACTIVATE
States
{
Spawn:
TNT1 A 0
stop
Pickup:
BLTR C 1 A_Jumpifinventory("RumAttackPower",1,"Pickup.Drunk")

BLTR C 1 A_Jumpifinventory("WilyTeamFlag",1,"TeamRedFire")
BLTR C 1 A_Jumpifinventory("LightTeamFlag",1,"TeamBlueFire")
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall",0,1,0,2)
stop
TeamRedFire:
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall",0,1,0,2)
TNT1 A 1
stop
TeamBlueFire:
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall",0,1,0,2)
TNT1 A 1
stop

Pickup.Drunk:
BLTR C 1 A_Jumpifinventory("WilyTeamFlag",1,"TeamRedDrunkFire")
BLTR C 1 A_Jumpifinventory("LightTeamFlag",1,"TeamBlueDrunkFire")
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall",Frandom(-6.7,6.7),1,0,2)
stop
TeamRedDrunkFire:
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall",Frandom(-6.7,6.7),1,0,2)
TNT1 A 1
stop
TeamBlueDrunkFire:
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall",Frandom(-6.7,6.7),1,0,2)
TNT1 A 1
stop
}
}

actor LCB_30TShooter : CustomInventory 
{
inventory.amount 1
Inventory.MaxAmount 100
+AUTOACTIVATE
States
{
Spawn:
TNT1 A 0
stop
Pickup:
BLTR C 1 A_Jumpifinventory("RumAttackPower",1,"Pickup.Drunk")

BLTR C 1 A_Jumpifinventory("WilyTeamFlag",1,"TeamRedFire")
BLTR C 1 A_Jumpifinventory("LightTeamFlag",1,"TeamBlueFire")
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall_30T",0,1,0,2)
stop
TeamRedFire:
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall_30T",0,1,0,2)
TNT1 A 1
stop
TeamBlueFire:
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall_30T",0,1,0,2)
TNT1 A 1
stop

Pickup.Drunk:
BLTR C 1 A_Jumpifinventory("WilyTeamFlag",1,"TeamRedDrunkFire")
BLTR C 1 A_Jumpifinventory("LightTeamFlag",1,"TeamBlueDrunkFire")
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall_30T",Frandom(-6.7,6.7),1,0,2)
stop
TeamRedDrunkFire:
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall_30T",Frandom(-6.7,6.7),1,0,2)
TNT1 A 1
stop
TeamBlueDrunkFire:
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall_30T",Frandom(-6.7,6.7),1,0,2)
TNT1 A 1
stop
}
}

actor LCB_25TShooter : CustomInventory 
{
inventory.amount 1
Inventory.MaxAmount 100
+AUTOACTIVATE
States
{
Spawn:
TNT1 A 0
stop
Pickup:
BLTR C 1 A_Jumpifinventory("RumAttackPower",1,"Pickup.Drunk")

BLTR C 1 A_Jumpifinventory("WilyTeamFlag",1,"TeamRedFire")
BLTR C 1 A_Jumpifinventory("LightTeamFlag",1,"TeamBlueFire")
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall_25T",0,1,0,2)
stop
TeamRedFire:
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall_25T",0,1,0,2)
TNT1 A 1
stop
TeamBlueFire:
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall_25T",0,1,0,2)
TNT1 A 1
stop

Pickup.Drunk:
BLTR C 1 A_Jumpifinventory("WilyTeamFlag",1,"TeamRedDrunkFire")
BLTR C 1 A_Jumpifinventory("LightTeamFlag",1,"TeamBlueDrunkFire")
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall_25T",Frandom(-6.7,6.7),1,0,2)
stop
TeamRedDrunkFire:
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall_25T",Frandom(-6.7,6.7),1,0,2)
TNT1 A 1
stop
TeamBlueDrunkFire:
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall_25T",Frandom(-6.7,6.7),1,0,2)
TNT1 A 1
stop
}
}

actor LCB_20TShooter : CustomInventory 
{
inventory.amount 1
Inventory.MaxAmount 100
+AUTOACTIVATE
States
{
Spawn:
TNT1 A 0
stop
Pickup:
BLTR C 1 A_Jumpifinventory("RumAttackPower",1,"Pickup.Drunk")

BLTR C 1 A_Jumpifinventory("WilyTeamFlag",1,"TeamRedFire")
BLTR C 1 A_Jumpifinventory("LightTeamFlag",1,"TeamBlueFire")
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall_20T",0,1,0,2)
stop
TeamRedFire:
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall_20T",0,1,0,2)
TNT1 A 1
stop
TeamBlueFire:
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall_20T",0,1,0,2)
TNT1 A 1
stop

Pickup.Drunk:
BLTR C 1 A_Jumpifinventory("WilyTeamFlag",1,"TeamRedDrunkFire")
BLTR C 1 A_Jumpifinventory("LightTeamFlag",1,"TeamBlueDrunkFire")
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall_20T",Frandom(-6.7,6.7),1,0,2)
stop
TeamRedDrunkFire:
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall_20T",Frandom(-6.7,6.7),1,0,2)
TNT1 A 1
stop
TeamBlueDrunkFire:
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall_20T",Frandom(-6.7,6.7),1,0,2)
TNT1 A 1
stop
}
}

actor LCB_15TShooter : CustomInventory 
{
inventory.amount 1
Inventory.MaxAmount 100
+AUTOACTIVATE
States
{
Spawn:
TNT1 A 0
stop
Pickup:
BLTR C 1 A_Jumpifinventory("RumAttackPower",1,"Pickup.Drunk")

BLTR C 1 A_Jumpifinventory("WilyTeamFlag",1,"TeamRedFire")
BLTR C 1 A_Jumpifinventory("LightTeamFlag",1,"TeamBlueFire")
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall_15T",0,1,0,2)
stop
TeamRedFire:
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall_15T",0,1,0,2)
TNT1 A 1
stop
TeamBlueFire:
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall_15T",0,1,0,2)
TNT1 A 1
stop

Pickup.Drunk:
BLTR C 1 A_Jumpifinventory("WilyTeamFlag",1,"TeamRedDrunkFire")
BLTR C 1 A_Jumpifinventory("LightTeamFlag",1,"TeamBlueDrunkFire")
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall_15T",Frandom(-6.7,6.7),1,0,2)
stop
TeamRedDrunkFire:
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall_15T",Frandom(-6.7,6.7),1,0,2)
TNT1 A 1
stop
TeamBlueDrunkFire:
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall_15T",Frandom(-6.7,6.7),1,0,2)
TNT1 A 1
stop
}
}

actor LCB_10TShooter : CustomInventory 
{
inventory.amount 1
Inventory.MaxAmount 100
+AUTOACTIVATE
States
{
Spawn:
TNT1 A 0
stop
Pickup:
BLTR C 1 A_Jumpifinventory("RumAttackPower",1,"Pickup.Drunk")

BLTR C 1 A_Jumpifinventory("WilyTeamFlag",1,"TeamRedFire")
BLTR C 1 A_Jumpifinventory("LightTeamFlag",1,"TeamBlueFire")
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall_10T",0,1,0,2)
stop
TeamRedFire:
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall_10T",0,1,0,2)
TNT1 A 1
stop
TeamBlueFire:
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall_10T",0,1,0,2)
TNT1 A 1
stop

Pickup.Drunk:
BLTR C 1 A_Jumpifinventory("WilyTeamFlag",1,"TeamRedDrunkFire")
BLTR C 1 A_Jumpifinventory("LightTeamFlag",1,"TeamBlueDrunkFire")
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall_10T",Frandom(-6.7,6.7),1,0,2)
stop
TeamRedDrunkFire:
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall_10T",Frandom(-6.7,6.7),1,0,2)
TNT1 A 1
stop
TeamBlueDrunkFire:
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall_10T",Frandom(-6.7,6.7),1,0,2)
TNT1 A 1
stop
}
}

actor LCB_5TShooter : CustomInventory 
{
inventory.amount 1
Inventory.MaxAmount 100
+AUTOACTIVATE
States
{
Spawn:
TNT1 A 0
stop
Pickup:
BLTR C 1 A_Jumpifinventory("RumAttackPower",1,"Pickup.Drunk")

BLTR C 1 A_Jumpifinventory("WilyTeamFlag",1,"TeamRedFire")
BLTR C 1 A_Jumpifinventory("LightTeamFlag",1,"TeamBlueFire")
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall_5T",0,1,0,2)
stop
TeamRedFire:
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall_5T",0,1,0,2)
TNT1 A 1
stop
TeamBlueFire:
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall_5T",0,1,0,2)
TNT1 A 1
stop

Pickup.Drunk:
BLTR C 1 A_Jumpifinventory("WilyTeamFlag",1,"TeamRedDrunkFire")
BLTR C 1 A_Jumpifinventory("LightTeamFlag",1,"TeamBlueDrunkFire")
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall_5T",Frandom(-6.7,6.7),1,0,2)
stop
TeamRedDrunkFire:
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall_5T",Frandom(-6.7,6.7),1,0,2)
TNT1 A 1
stop
TeamBlueDrunkFire:
PRMI C 1 A_FireCustomMissile("CaptLooseCannonBall_5T",Frandom(-6.7,6.7),1,0,2)
TNT1 A 1
stop
}
}