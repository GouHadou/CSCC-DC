//==|Buddy Sentry|==
const int BSEN_SPD = 75; //Bullet
const int BSEN_SPD2 = 25; //Sight
const int BSEN_Warm = 25;

const int BSEN_X = 65;
const int BSEN_Z = 45;
const int BSEN_DetectRange = 750;
const int BSEN_ForgetRange = 800;




actor GadgetSentry
{
//+SOLID
+Shootable
+MISSILE
//+NOCLIP
+NODAMAGETHRUST
+DONTBLAST
//+STANDSTILL  //doesn't seem to do anything
+SKYEXPLODE
+DONTSEEKINVISIBLE//
+SEEKERMISSILE
+NoTargetSwitch
+FLOORHUGGER
+NOBLOOD
//+QuickToRetaliate
//==
Var int user_tally;
speed 1
DamageFactor "Sentryshot", 0
DamageFactor "Dynashock", 0
scale 2.5
Radius 20
Height 40
Health 150
gravity 999
reactiontime 256
PainChance 256
Species "Turret"
states
{

Spawn:
//[+]=======|Warmup Phase|======[+]
TRET A 0 
TRET A 0 A_GiveInventory("IsSentry",1) 
ETRD A 0 A_GiveToTarget("SentryGoingup")
TRET A 1 A_RearrangePointers(AAPTR_DEFAULT, AAPTR_TARGET, AAPTR_DEFAULT) //set the owner to the master pointer
TRET A 1 A_ChangeFlag("Missile",false)
Warmup:
TRET A 1 A_jumpifinventory("WeaponCharge",BSEN_Warm+1,"Scan")
TRET A 1 A_jumpifinventory("WeaponCharge",BSEN_Warm,"Ready")
TRET A 0 A_PlaySoundEx("weapon/heat1", "Weapon")
TRET A 0 A_GiveInventory("WeaponCharge",1) 
TRET A 1
TRET A 0 A_jumpifinventory("WeaponCharge",BSEN_Warm,"Ready")
loop
//[+]=======|Armed Phase|======[+]
Ready:
TRET A 1
	//---Health Check---
	TRET A 0 A_Takefromtarget("GadgetSentryHPView",9999)
	TRET A 0 A_Givetotarget("GadgetSentryHPView",Health)
	//---
TRET A 0 A_CheckFlag("NOGRAVITY", "Terminate", AAPTR_MASTER)
TRET A 0 A_ChangeFlag("QuickToRetaliate",true)
TRET A 0 A_GiveInventory("WeaponCharge",1) 
TRET A 0  A_PlaySoundEx("misc/gravitywarn","Weapon")

TRET A 1 A_Jumpifintargetinventory("RCSInControl",1,"Remote")
Goto Scan


Scan: //[+]=======|Scanning Phase|======[+]
TRET A 0 A_CheckFlag("NOGRAVITY", "Terminate", AAPTR_MASTER)

TRET A 0 A_RearrangePointers(AAPTR_DEFAULT, AAPTR_DEFAULT, AAPTR_NULL)
TRET A 0 A_SetAngle(5+angle)
TRET A 0 A_Jumpif(angle>=340,"AngleReset") 
TRET AA 1 A_Lookex(LOF_NOSOUNDCHECK,1,BSEN_DetectRange,BSEN_DetectRange,90,"TargetCheck")//A_SeekerMissile(0,0,SMF_LOOK,100,BSEN_DetectRange)//TargetCheck
TRET A 0 A_Jumpifintargetinventory("GadgetSentryReclaim",1,"Checkreturn")
TRET A 0 A_Jumpifintargetinventory("RCSInControl",1,"Remote")
Goto Scan
	AngleReset:
	TRET A 0 A_SetAngle(1)
	Goto Scan
//=====
TargetCheck: //Visibility & detectability
TRET A 1
TRET A 0 A_CheckFlag("INVISIBLE","Scan",AAPTR_TARGET)
TRET A 0 A_JumpIfInTargetInventory("InvisibleFlag",1,"Scan")
TRET A 0 A_CheckFlag("SHADOW","Scan",AAPTR_TARGET)
TRET A 0 A_Jumpifintargetinventory("ReachedFullInvis",1,"Scan") 

//====Check if we are looking at our maker
TRET A 0 A_JumpIf(IsPointerEqual(AAPTR_TARGET, AAPTR_MASTER) == TRUE, "Scan")
TRET A 0 A_Jump(256,"TargetCheck2")
Goto TargetCheck2

TargetCheck2: //Team allaiance
//TRET A 1 A_Jumpifintargetinventory("WilyTeamFlag",1,"Spotted") //found an enemy!
TRET A 0 A_checkflag("IsMonster","Spotted",AAPTR_TARGET) //found an enemy!
TRET A 0 A_Jump(256,"Spotted")
Goto Scan
Spotted:
TRET A 1
TRET A 0 A_RearrangePointers(AAPTR_MASTER, AAPTR_DEFAULT, AAPTR_TARGET)// set the target as our tracer, and the owner as our target again.
TRET A 0 A_PlaySoundEx("weapon/flashstopper","Weapon")
TRET AAA 1 A_FaceTracer
TRET A 0 A_PlaySoundEx("weapon/flashstopper","Weapon")
TRET AAA 1 A_FaceTracer
TRET A 0 A_PlaySoundEx("weapon/flashstopper","Weapon")
TRET AAA 1 A_FaceTracer
TRET A 1 


Missile: //[+]=======|Firing Phase|======[+]
TRET A 0 A_ChangeFlag("Missile",false)
TRET A 0 A_RearrangePointers(AAPTR_MASTER, AAPTR_DEFAULT, AAPTR_DEFAULT) //reset target to master
TRET A 0 A_FaceTracer
TRET A 0 ACS_NamedExecuteAlways("PitchToTracer",0,0)
TRET A 0 A_Changevelocity(0,0,0,CVF_REPLACE) //Prevents movement
TNT1 A 0 A_Stop
TRET A 1 A_GiveInventory("TurretReticleSpawner",1,AAPTR_TRACER)
TRET A 0 A_GiveInventory("GadgetsentryShooter")
TRET A 0 A_PlaySoundEx("weapon/BasherShot","Body")

Afterfire:
TRET AAAAA 1 A_GiveInventory("TurretReticleSpawner",1,AAPTR_TRACER)//A_Changevelocity(0,0,0,CVF_REPLACE) //Prevents movement
TRET A 0 
TRET A 0// A_Jumpifinventory("RespawnCamera",1,"Scan",AAPTR_TRACER) //
TRET A 0 A_Jumpifinventory("CutterFlag",999,"Scan",AAPTR_TRACER) //
TRET A 0 A_Jumpifintargetinventory("GadgetSentryReclaim",1,"Checkreturn")
TRET A 0 A_Jumpifintargetinventory("RCSInControl",1,"Remote")
TRET A 0 A_ChangeFlag("Missile",true)
TRET A 0 A_JumpIfTargetInLOS ("Missile", 0, JLOSF_PROJECTILE,BSEN_ForgetRange  )//JLOSF_PROJECTILE
TRET A 0 A_ChangeFlag("Missile",false)
TRET A 0 
Goto Scan

//[+]=======|Remote Controlled Phase|======[+]
Remote:
TRET A 1
TRET A 0 A_TakeInventory("SentryStalling",9)
TRET A 0 A_Changevelocity(0,0,0,CVF_REPLACE)
TRET A 0 A_JumpIfInTargetInventory("RCSShoot", 1, "Shoot")
TRET A 0 A_GiveInventory("TargetMarker2", 1,AAPTR_MASTER)
TRET A 0 ACS_ExecuteAlways(989, 0, ACS_ExecuteWithResult(257)+100, 32)
TRET A 0 A_GiveInventory("SentrySightShooter")
TRET A 0 A_JumpIfInTargetInventory("RCSInControl", 1, "Remote")
TRET A 0 //ACS_ExecuteAlways(998,0,175)
goto Scan
Shoot:
TRET A 0 A_PlaySoundEx("weapon/BasherShot","weapon")
TRET A 1 A_GiveInventory("TargetMarker2", 1,AAPTR_MASTER)
	TRET A 0 A_Giveinventory("SentrySightShooter")
TRET A 1 ACS_ExecuteAlways(989, 0, ACS_ExecuteWithResult(257)+100, 32)
	TRET A 0 A_Giveinventory("SentrySightShooter")
TRET A 1 A_GiveInventory("GadgetsentryShooter", 1)
	TRET A 0 A_Giveinventory("SentrySightShooter")
TRET A 0 A_JumpIfInTargetInventory("RCSInControl", 1, "Remote")
Goto Scan



//[+]=======|Sentry Pickup Phase|======[+]
Checkreturn:
TRET A 1 A_JumpIfTargetInLOS("Recall",30,JLOSF_TARGETLOS,200)
TRET A 0// A_SpawnItemEX("PickupIndicator",0,0,40,0,0,0,0)
TRET A 0 A_JumpIfInTargetInventory("RCSInControl", 1, "Remote")
TRET A 0 A_jumpifinventory("SentryStalling",1,"Stall")
TRET A 0 A_JumpIfTargetInLOS ("Missile", 0, JLOSF_PROJECTILE,1000  )
Goto Scan

Stall:
TRET A 0 A_Jumpifintargetinventory("RCSInControl",1,"Remote")
TRET A 0 A_GiveInventory("SentryStalling",1) 
TRET A 0 A_PlaySoundEx("weapon/gemini","Voice")
TRET A 0 A_Takeinventory("CutterFlag",10)
TRET AAAAAAAAAAAAAAAAAAAAAAAAA 1 A_Jumpifintargetinventory("GadgetSentryReclaim",1,"Checkreturn")
TRET A 0 A_jumpifinventory("CutterFlag",1,"Stall")
TRET A 0 A_TakeInventory("SentryStalling",9) 
Goto See

Recall:
TFOG A 0 A_Takefromtarget("GadgetSentryHPView",9999)
TNT1 A 1 A_Takefromtarget("GadgetSentryActive",9)
TNT1 A 1// A_Takefromtarget("GadgetSentryController",9)
TNT1 A 0 A_GiveInventory("Movingthis",1,AAPTR_MASTER)
TFOG BC 2
Stop

Pain:
TRET A 1 A_Stop//
	//---Health Check---
	TRET A 0 A_Takefromtarget("GadgetSentryHPView",9999)
	TRET A 0 A_Givetotarget("GadgetSentryHPView",Health)
	//---
TRET A 0 A_PlaySoundEx("misc/mm4pain", "Voice")
TRET A 0 
TRET A 0 A_JumpIfTargetInLOS ("Missile", 0, JLOSF_PROJECTILE,BSEN_DetectRange  )
TRET A 0 A_RearrangePointers(AAPTR_MASTER, AAPTR_DEFAULT, AAPTR_DEFAULT) //reset target to master
TRET A 0 A_jumpifinventory("WeaponCharge",BSEN_Warm+1,"Scan")

Goto Warmup

Death:
TRET A 0 A_RearrangePointers(AAPTR_MASTER, AAPTR_DEFAULT, AAPTR_DEFAULT) //reset target to master
TNT1 A 0 A_PlaySoundEx("weapon/napalm", "Weapon")
TNT1 A 1 A_SpawnItemEx("TopExplosion")
TNT1 A 0 A_Takefromtarget("GadgetSentryActive",9)
TNT1 A 1// A_Takefromtarget("GadgetSentryController",9)
TNT1 A 0 A_GiveInventory("SentryDown",0,AAPTR_MASTER)
TNT1 A 0 
TNT1 A 4
stop
Perish:
Terminate:
TNT1 A 0 
TNT1 A 4
stop
}
}

	actor GadgetSentry_R : GadgetSentry
	{
	translation "244:244=191:191", "75:75=43:43", "74:74=41:41", "205:205=171:171", "196:196=170:170"
	Designatedteam 1
	//Species "REDMember"
	States
	{
	TargetCheck2:
	TRET A 0// A_Jumpifintargetinventory("RespawnCamera",1,"Scan") //can't shoot what you can't see,
	TRET A 0 A_Jumpifintargetinventory("LightTeamFlag",1,"Spotted") //found an enemy!
	TRET A 0 A_checkflag("IsMonster","Spotted",AAPTR_TARGET) //found an enemy!
	Goto Scan
	}
	}

	actor GadgetSentry_B : GadgetSentry
	{
	Designatedteam 0
	//Species "BLUEMember"
	States
	{
	TargetCheck2:
	TRET A 0 //A_Jumpifintargetinventory("RespawnCamera",1,"Scan") //can't shoot what you can't see,
	TRET A 0 A_Jumpifintargetinventory("WilyTeamFlag",1,"Spotted") //found an enemy!
	TRET A 0 A_checkflag("IsMonster","Spotted",AAPTR_TARGET) //found an enemy!
	Goto Scan
	}
	}

actor GadgetsentryActive : Inventory // anti-spam
{
inventory.amount 1
inventory.maxamount 1
}

actor GadgetsentryReclaim : Powerup // anti-spam
{
inventory.amount 1
inventory.maxamount 1
Powerup.Duration 3
}


actor GadgetsentryHPView : Inventory // anti-spam
{
inventory.amount 1
inventory.maxamount 150
}
//===
actor IsSentry : Inventory // anti-spam
{
inventory.amount 1
inventory.maxamount 1
}

actor RCSInControl : Powerup // anti-spam
{
inventory.amount 1
inventory.maxamount 1
Powerup.Duration 15
}

actor RCSShoot : Inventory // anti-spam
{
inventory.amount 1
inventory.maxamount 1
}

Actor SentryStalling : Inventory //Flag for if sentry is in it's stall period
{
inventory.amount 1
inventory.maxamount 1
}

Actor TurretReticleHold : Powerup {inventory.amount 1 inventory.maxamount 1 Powerup.Duration 10}


Actor TargetMarker2 : CustomInventory
{
Inventory.amount 1
Inventory.MaxAmount 1
+AUTOACTIVATE
States
{
Spawn:
TNT1 A 1
stop
Use:
TNT1 A 0 A_FireCustomMissile("TargetTracer",0,0,0,16,0,0)
//TNT1 A 0 A_SpawnItemEx("TargetTracer", 0, 8, 32, Cos(pitch)*1000, 0, sin(-pitch)*1000,0)
stop
}
}
//[+]========================================================================[+]
//--------------------------------|Projectiles|------------------------------
//[+]========================================================================[+]

actor GadgetsentryBullet
{
Obituary "$OB_Gadgetsentry"
PROJECTILE
+DONTBLAST
+MTHRUSPECIES
+BLOODSPLATTER
//+NOCLIP
Speed 90
Damage (10)
scale 2.5
damagetype "SentryShot"
Height 3
Radius 3
Var Int User_TrailCount;
Var Int User_TP;
args -10, 75
States
{
Spawn:
TNT1 A 0
//BASB T 1
//BASB T 0 A_Changeflag("NOCLIP",0)
TNT1 A 1
TNT1 A 0 A_SpawnItemEx("GadgetsentryTrail",-args[1] + cos(pitch)*-5,0,-MomZ + args[0]+(sin(pitch)*5),momX,MomY,MomZ,0,SXF_TRANSFERPITCH|SXF_ABSOLUTEMOMENTUM|SXF_TRANSFERTRANSLATION)
TNT1 A 0 A_SpawnItemEx("GadgetsentryTrail",-args[1] + cos(pitch)*-10,0,-MomZ + args[0]+(sin(pitch)*10),momX,MomY,MomZ,0,SXF_TRANSFERPITCH|SXF_ABSOLUTEMOMENTUM|SXF_TRANSFERTRANSLATION)
TNT1 A 0 A_SpawnItemEx("GadgetsentryTrail",-args[1] + cos(pitch)*-15,0,-MomZ + args[0]+(sin(pitch)*15),momX,MomY,MomZ,0,SXF_TRANSFERPITCH|SXF_ABSOLUTEMOMENTUM|SXF_TRANSFERTRANSLATION)
TNT1 A 0 A_SpawnItemEx("GadgetsentryTrail",-args[1] + cos(pitch)*-20,0,-MomZ + args[0]+(sin(pitch)*20),momX,MomY,MomZ,0,SXF_TRANSFERPITCH|SXF_ABSOLUTEMOMENTUM|SXF_TRANSFERTRANSLATION)
TNT1 A 0 A_SpawnItemEx("GadgetsentryTrail",-args[1] + cos(pitch)*-25,0,-MomZ + args[0]+(sin(pitch)*25),momX,MomY,MomZ,0,SXF_TRANSFERPITCH|SXF_ABSOLUTEMOMENTUM|SXF_TRANSFERTRANSLATION)
TNT1 A 0 A_SpawnItemEx("GadgetsentryTrail",-args[1] + cos(pitch)*-30,0,-MomZ + args[0]+(sin(pitch)*30),momX,MomY,MomZ,0,SXF_TRANSFERPITCH|SXF_ABSOLUTEMOMENTUM|SXF_TRANSFERTRANSLATION)
TNT1 A 0 A_SpawnItemEx("GadgetsentryTrail",-args[1] + cos(pitch)*-35,0,-MomZ + args[0]+(sin(pitch)*35),momX,MomY,MomZ,0,SXF_TRANSFERPITCH|SXF_ABSOLUTEMOMENTUM|SXF_TRANSFERTRANSLATION)
TNT1 A 0 A_SpawnItemEx("GadgetsentryTrail",-args[1] + cos(pitch)*-40,0,-MomZ + args[0]+(sin(pitch)*40),momX,MomY,MomZ,0,SXF_TRANSFERPITCH|SXF_ABSOLUTEMOMENTUM|SXF_TRANSFERTRANSLATION)
TNT1 A 0 A_SpawnItemEx("GadgetsentryTrail",-args[1] + cos(pitch)*-45,0,-MomZ + args[0]+(sin(pitch)*45),momX,MomY,MomZ,0,SXF_TRANSFERPITCH|SXF_ABSOLUTEMOMENTUM|SXF_TRANSFERTRANSLATION)
TNT1 A 0 A_SpawnItemEx("GadgetsentryTrail",-args[1] + cos(pitch)*-50,0,-MomZ + args[0]+(sin(pitch)*50),momX,MomY,MomZ,0,SXF_TRANSFERPITCH|SXF_ABSOLUTEMOMENTUM|SXF_TRANSFERTRANSLATION)
loop

Death:
TNT1 A 0 A_Spawnitemex("SentryShotPuff")
TNT1 A 0 //A_Spawnitemex("GadgetsentryThrustSource")
Stop
}
}

	actor GadgetsentryBullet_BLUE : GadgetsentryBullet
	{	}
	
	actor GadgetsentryBullet_RED : GadgetsentryBullet
	{
	translation "192:192=54:54", "198:198=42:42" , "196:196=170:170", "199:199=47:47", "241:241=191:191"
	}


actor RemoteSight : FastProjectile
{
PROJECTILE
+BLOODSPLATTER
+DONTBLAST
+NOBLOOD
+MTHRUSPECIES
radius 8
height 8
Speed 5
Damage (0)
damagetype "SentryShot"
scale 1.5
Obituary "%o failed to evade %k's beamspin!"
Reactiontime 14
renderstyle "Translucent"
Alpha 0.6
States
{
Spawn:
TNT1 A 0
TNT1 A 1 A_SpawnItemEx("RemoteSight",0,0,0,momx,momy,momz,0,SXF_ABSOLUTEMOMENTUM|SXF_TRANSFERTRANSLATION|SXF_TRANSFERPOINTERS) //A_custommissile("FreezeRayShot2",0,0,0, 2,-pitch)
TNT1 A 0 A_Stop
TNT1 A 0 A_SpawnItemEx("RemoteSightDot",0,0,0,0,0,0,0,1) //A_custommissile("FreezeRayShot2",0,0,0, 2,-pitch)
stop
Death:
Crash:
XDeath:
TNT1 A 0 A_SpawnItemEx("TurretRetical2",8,0,8,momx,momy,momz,0,SXF_ABSOLUTEMOMENTUM|SXF_TRANSFERTRANSLATION|SXF_TRANSFERPOINTERS)
Stop
}
}

	actor RemoteSight_BLUE : RemoteSight
	{	
	} //Species "BLUEMember"
	
	actor RemoteSight_RED : RemoteSight
	{ //Species "REDMEMBER"
	translation "192:192=54:54", "198:198=42:42" , "196:196=170:170", "199:199=47:47", "241:241=191:191"
	}



actor TargetTracer3 //: Fastprojectile 
{
Radius 4
Height 1
PROJECTILE
Speed 4000
Damage(0)
RenderStyle "NONE"
+DONTSPLASH
+DONTBLAST
+THRUGHOST
+SKYEXPLODE
 //+NoInteraction
 //+NOCLIP
States
{
Spawn:
TNT1 A 0 
TNT1 A 1 A_SpawnItemEx("TargetAimPoint", 0, 0, 0)  //Thing_SpawnNoFog(0,201,0,ACS_ExecuteWithResult(257, 0)+100) 
stop
}
}

Actor TargetMarker3 : CustomInventory
{
Inventory.amount 1
Inventory.MaxAmount 1
+AUTOACTIVATE
States
{
Spawn:
TNT1 A 1
stop
Use:
TNT1 A 0 A_FireCustomMissile("TargetTracer3",0,0,0,16,0,0)
//TNT1 A 0 A_SpawnItemEx("TargetTracer", 0, 8, 32, Cos(pitch)*1000, 0, sin(-pitch)*1000,0)
stop
}
}

//[+]========================================================================[+]
//--------------------------------|Effect Actors|------------------------------
//[+]========================================================================[+]
actor GadgetsentryTrail 
{
PROJECTILE
+NOINTERACTION
+NOCLIP
+CLIENTSIDEONLY
radius 8
height 8
Damage (0)
Reactiontime 35
Renderstyle "Add"

scale 1.5
Alpha 0.9
States
{
Spawn:
CRBM A 0
BASH B 2
stop
}
}

actor SentryShotPuff 
{
PROJECTILE
+NOINTERACTION
+NOCLIP
+CLIENTSIDEONLY
Reactiontime 14
renderstyle "Translucent"
Alpha 0.9
scale 1.5
States
{
Spawn:
BIM1 AABCDEF 1
stop
}
}

actor RemoteSightDot 
{
PROJECTILE
+NOINTERACTION
+NOCLIP
+CLIENTSIDEONLY
Reactiontime 14
renderstyle "Add"
Alpha 0.9
States
{
Spawn:
TNT1 A 0
BASB U 1  
stop
}
}

actor TurretRetical 
{
PROJECTILE
+NOINTERACTION
+NOCLIP
+DONTSPLASH
-CLIENTSIDEONLY
scale 3.2
States
{
Spawn:
TNT1 A 0 
TNT1 A 0 ACS_NamedExecuteAlways("TurretReticleWarper", 0, 0)
Shield:
RETC AAA  1 A_Warp(AAPTR_TARGET,-2,0,40,0,WARPF_NOCHECKPOSITION|WARPF_INTERPOLATE)
loop
}
}

actor TurretRetical2 
{
PROJECTILE
+NOINTERACTION
+NOCLIP
+DONTSPLASH
-CLIENTSIDEONLY
scale 3.2
States
{
Spawn:
TNT1 A 0 
RETC A  1
stop
}
}
//[+]========================================================================[+]
actor SentryMarker  // 
{
PROJECTILE
//+NOINTERACTION
+NOGRAVITY
//+FLOORHUGGER
+NOTARGETSWITCH
height 30
Radius 80
damage (0)
reactiontime 1
scale 2.5
RenderStyle "ADD"
Alpha 1
States
{
Spawn:
TNT1 A 0
TREG A 2
stop
Crash:
XDeath:
TREG B 0 A_Changeflag("NOINTERACTION",1)
TREG B 1 //A_GiveToTarget("SpawnDeny")
TNT1 A 1 A_SpawnitemEx("SentryMarker2", 0, 0, 0, momx, momy, momz, 0, SXF_ABSOLUTEMOMENTUM, 0)
Stop
Death:
TREG B 0 A_Changeflag("NOINTERACTION",1)
TREG B 1// A_GiveToTarget("SpawnDeny")
TNT1 A 1 A_SpawnitemEx("SentryMarker2", 0, 0, 0, momx, momy, momz, 0, SXF_ABSOLUTEMOMENTUM, 0)
stop
}
}

actor SentryMarker2  // 
{
PROJECTILE
+NOINTERACTION
+NOGRAVITY
//+FLOORHUGGER
+NOTARGETSWITCH
height 30
Radius 80
damage (0)
reactiontime 1
scale 2.5
RenderStyle "ADD"
Alpha 1
States
{
Spawn:
TNT1 A 0
TREG B 2
stop
stop
}
}
//[+]========================================================================[+]
//--------------------------------|Item Shooters|------------------------------
//[+]========================================================================[+]

actor GadgetsentryShooter : CustomInventory 
{
inventory.amount 1
Inventory.MaxAmount 100
+AUTOACTIVATE
States
{
Spawn:
TNT1 A 0
stop
Pickup:
BLTR C 0 A_JumpifinTargetinventory("WilyTeamFlag",1,"TeamRedFire")
BLTR C 0 A_JumpifinTargetinventory("LightTeamFlag",1,"TeamBlueFire")
BUST B 0 A_SpawnItemEx("GadgetsentryBullet",cos(-pitch)*BSEN_X,0,BSEN_Z+(sin(pitch)*BSEN_X),cos(-pitch)*BSEN_SPD,0,sin(pitch)*-BSEN_SPD,0,SXF_TRANSFERPOINTERS|SXF_TRANSFERPITCH)
stop
TeamRedFire:
BUST B 0 A_SpawnItemEx("GadgetsentryBullet_RED",cos(-pitch)*BSEN_X,0,BSEN_Z+(sin(pitch)*BSEN_X),cos(-pitch)*BSEN_SPD,0,sin(pitch)*-BSEN_SPD,0,SXF_TRANSFERPOINTERS|SXF_TRANSFERPITCH)
TNT1 A 0
stop
TeamBlueFire:
BUST B 0 A_SpawnItemEx("GadgetsentryBullet_BLUE",cos(-pitch)*BSEN_X,0,BSEN_Z+(sin(pitch)*BSEN_X),cos(-pitch)*BSEN_SPD,0,sin(pitch)*-BSEN_SPD,0,SXF_TRANSFERPOINTERS|SXF_TRANSFERPITCH)
TNT1 A 0
stop
}
}

actor SentrySightShooter : CustomInventory 
{
inventory.amount 1
Inventory.MaxAmount 100
+AUTOACTIVATE
States
{
Spawn:
TNT1 A 0
stop
Pickup:
BLTR C 0 A_JumpifinTargetinventory("WilyTeamFlag",1,"TeamRedFire")
BLTR C 0 A_JumpifinTargetinventory("LightTeamFlag",1,"TeamBlueFire")
BUST B 0 A_SpawnItemEx("RemoteSight",cos(-pitch)*BSEN_X,0,BSEN_Z+(sin(pitch)*BSEN_X),cos(-pitch)*BSEN_SPD2,0,sin(pitch)*-BSEN_SPD2,0,SXF_TRANSFERPOINTERS|SXF_TRANSFERPITCH)
stop
TeamRedFire:
BUST B 0 A_SpawnItemEx("RemoteSight_RED",cos(-pitch)*BSEN_X,0,BSEN_Z+(sin(pitch)*BSEN_X),cos(-pitch)*BSEN_SPD2,0,sin(pitch)*-BSEN_SPD2,0,SXF_TRANSFERPOINTERS|SXF_TRANSFERPITCH)
TNT1 A 0
stop
TeamBlueFire:
BUST B 0 A_SpawnItemEx("RemoteSight_BLUE",cos(-pitch)*BSEN_X,0,BSEN_Z+(sin(pitch)*BSEN_X),cos(-pitch)*BSEN_SPD2,0,sin(pitch)*-BSEN_SPD2,0,SXF_TRANSFERPOINTERS|SXF_TRANSFERPITCH)
TNT1 A 0
stop
}
}


actor GadgetsentryPlanter : CustomInventory  //places a sentry based on the team.
{
inventory.amount 1
Inventory.MaxAmount 100
+AUTOACTIVATE
States
{
Spawn:
TNT1 A 0
stop
Pickup:
BLTR C 0 A_Jumpifinventory("WilyTeamFlag",1,"TeamRedFire")
BLTR C 0 A_Jumpifinventory("LightTeamFlag",1,"TeamBlueFire")
//---otherwise, just place a blank one
GDTB A 0 A_SpawnItemEX("Gadgetsentry",120,0,0,0,0,0,0,SXF_SETMASTER)
stop
TeamRedFire:
GDTB A 0 A_SpawnItemEX("Gadgetsentry_R",120,0,0,0,0,0,0,SXF_SETMASTER)
TNT1 A 0
stop
TeamBlueFire:
GDTB A 0 A_SpawnItemEX("Gadgetsentry_B",120,0,0,0,0,0,0,SXF_SETMASTER)
TNT1 A 0
stop
}
}

actor TurretReticleSpawner : CustomInventory 
{
States
{
Pickup:
BLTR C 0
BLTR C 0 A_Jumpifinventory("TurretReticleHold",1,"ReticleHold")
BLTR C 0 //A_Jumpifinventory("WilyTeamFlag",1,"TeamRedFire")
BLTR C 0// A_Jumpifinventory("LightTeamFlag",1,"TeamBlueFire")

PRMN A 0 A_SpawnitemEx("TurretRetical",-2,0,40,momx,momy,momz,0,SXF_ABSOLUTEMOMENTUM)
TNT1 A 0 A_GiveInventory("TurretReticleHold")
stop
TeamRedFire:
PRMN A 0// A_SpawnitemEx("TurretRetical_BLUE",-2,0,40,momx,momy,momz,0,SXF_ABSOLUTEMOMENTUM)
TNT1 A 0 A_GiveInventory("TurretReticleHold")
stop
TeamBlueFire:
PRMN A 0// A_SpawnitemEx("TurretRetical_RED",-2,0,40,momx,momy,momz,0,SXF_ABSOLUTEMOMENTUM)
TNT1 A 0 A_GiveInventory("TurretReticleHold")
stop
ReticleHold:
TNT1 A 0 A_GiveInventory("TurretReticleHold")
stop
}
}