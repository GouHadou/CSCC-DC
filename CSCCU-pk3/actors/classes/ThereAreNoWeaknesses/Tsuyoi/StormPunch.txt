Actor PunchFlag : Inventory
{
Inventory.amount 1
Inventory.maxamount 4
}

Actor KickCharge : Inventory
{
Inventory.amount 1
Inventory.maxamount 50
}

actor StormPunchWep : BaseMM8BDMWep
{
Weapon.AmmoUse 0
Weapon.AmmoGive 0
Weapon.SlotNumber 1
Obituary "%o was killed by %k's Storm Punches."
Inventory.Pickupmessage "Power up! Storm Punch!" 
inventory.pickupsound "weapon/weaponup"
+WEAPON.AMMO_OPTIONAL 
inventory.icon "TNT1A0"
Scale 2.0
States
{
Spawn:
TNT1 A 0
TNT1 A 1// A_SpawnItemEX("JumpKickDropper")
stop
Ready:
TSUY B 0 ACS_ExecuteAlways(998,0,501)
TSUY B 10 A_WeaponReady
Goto Ready+1
Deselect:
TNT1 A 0 A_SelectWeapon("StormPunchWep")
TNT1 AAAAAAAAAAAAAAAAAAAAAA 0 A_Lower
TSUY B 1 A_Lower
Loop
Select:
TNT1 AAAAAAAAAAAAAAAAAAAAAA 0 A_Raise
TSUY B 1 A_Raise
Loop
Fire:
TSUY B 0 A_PlaySoundEx("tsuyoi/punch","Weapon")
TSUY B 0 A_FireCustomMissile("StormPunch1",0,0,8,0)
TSUY CD 3
TSUY B 1
TSUY B 2 A_JumpIfInventory("PunchFlag",1,"Continue")
TSUY B 50 
TSUY B 0 A_TakeInventory("PunchFlag",5)
TSUY B 1 A_Refire
Goto Ready+1
Continue:
TSUY B 0 A_PlaySoundEx("tsuyoi/punch","Weapon")
TSUY B 0 A_FireCustomMissile("StormPunch2",0,0,8,0)
TSUY CD 3
TSUY B 5
TSUY B 2 A_JumpIfInventory("PunchFlag",2,"Continue2")
TSUY B 2
TSUY B 0 A_TakeInventory("PunchFlag",5)
TSUY B 20
TSUY B 1 A_Refire
Goto Ready+1
Continue2:
TSUY B 0 A_PlaySoundEx("tsuyoi/punch","Weapon")
TSUY B 0 A_FireCustomMissile("StormPunch2",0,0,8,0)
TSUY CD 3
TSUY B 5
TSUY B 2 A_JumpIfInventory("PunchFlag",3,"Continue3")
TSUY B 2
TSUY B 0 A_TakeInventory("PunchFlag",5)
TSUY B 20
TSUY B 1 A_Refire
Goto Ready+1
Continue3:
TSUY B 0 A_PlaySoundEx("tsuyoi/punch","Weapon")
TSUY B 0 A_FireCustomMissile("StormPunch2",0,0,8,0)
TSUY CD 3
TSUY B 5
TSUY B 0 A_TakeInventory("PunchFlag",5)
TSUY B 20
TSUY B 1 A_Refire
Goto Ready+1
AltFire:
TSUY B 1 A_JumpIf(z-floorz<=64, "AltHold")
TSUY B 1
goto JumpKick
AltHold:
TSUY B 2 A_GiveInventory("KickCharge",2)
TSUY B 2 A_JumpIfInventory("KickCharge",50,"Kick")
TSUY B 1 A_Refire
goto Kick
Kick:
BKIC C 0 A_JumpIfNoAmmo("NoAmmo")
BKIC C 0 A_PlaySoundEx("weapon/chargekick","Weapon")
BKIC C 0 A_ChangeFlag("SOLID",0)
KickReal:
BKIC C 0 //SetPlayerProperty(0,1,0)
BKIC C 2 A_ChangeVelocity(25,0,momz,CVF_RELATIVE|CVF_REPLACE)
BKIC B 2 A_FireCustomMissile("StormKick",0,0,0,0)
BKIC B 0 A_TakeInventory("KickCharge",10)
BKIC B 0 A_JumpIfInventory("KickCharge",1,"KickReal")
BKIC A 8 //SetPlayerProperty(0,0,0)
BKIC B 5
BKIC C 0 A_ChangeFlag("SOLID",1)
BKIC C 45
goto Ready+1
JumpKick:
BKIC C 1 A_SpawnItemEx("JumpKick",0,0,-15,0,0,0,0)
BKIC C 2 ThrustThingZ(0,20,1,1)
BKIC C 0 A_ChangeVelocity(30,0,momz,CVF_RELATIVE|CVF_REPLACE)
BKIC C 1 A_JumpIf(z-floorz<=0 || momz==0, "EndKick")
loop
EndKick:
TSUY B 1
TSUY B 1 A_SpawnItemEx("JumpKickWave")
TSUY B 1 DamageThing(20)
TSUY B 0
TSUY B 50
TSUY B 1
goto Ready+1
NoAmmo:
TSUY B 1
TSUY B 1 ACS_Execute(979,0)
Goto Ready+1
}
}

actor StormPunch1
{
PROJECTILE
Radius 10
Obituary "%o knocked down by %k's Storm Punches."
Height 10
+DONTBLAST
scale 2.5
+NOTARGETSWITCH
damage (20)
damagetype "HardKnuckle"
speed 20
States
{
Spawn:
TSUP A 5
stop
Death:
stop
XDEATH:
TNT1 A 1 A_GivetoTarget("PunchFlag",1)
stop
}
}

actor StormPunch2 : StormPunch1
{
Damage (15)
}

actor StormKick
{
PROJECTILE
Radius 14
Height 25
Obituary "%o was destroyed by %k's Storm Kick."
scale 2.5
damage (30)
damagetype "ChargeKick"
speed 40
States
{
Spawn:
CKIC E 0
CKIC E 0
CKIC E 2
stop
}
}

actor JumpKick : StormKick
{
Damage (80)
Obituary "%o was stomped on by %k's Jump Kick."
States
{
Spawn:
CKIC E 0
CKIC E 0
CKIC E 4 A_Explode(100,128,0)
stop
Death:
stop
}
}

actor JumpKickWave : StormKick
{
Obituary "%o was stomped on by %k's Jump Kick."
Damage (1)
Damagetype "SparkShock"
States
{
Spawn:
TNT1 A 0
TNT1 A 0
TNT1 A 2
goto Death
Death:
TNT1 A 1 A_Explode(25,128,1)
stop
}
}