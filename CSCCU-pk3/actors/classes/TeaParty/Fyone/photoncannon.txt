actor PhotonCannonWep : Base8BDMWeapon 18042
{
Weapon.AmmoUse 0
Weapon.AmmoGive 28
Weapon.SlotNumber 5
Obituary "%o was obliterated by %k's Photon Cannon." 
Inventory.Pickupmessage "Power up! Photon Cannon!"
weapon.ammotype "FlyAmmo"
inventory.pickupsound "weapon/weaponup"
+WEAPON.AMMO_OPTIONAL
+INVENTORY.UNDROPPABLE
+WEAPON.CHEATNOTWEAPON
Scale 2.0
DropItem "PharaohShotWep"
States
{
Spawn: 
WEA2 L 1
loop
Ready: 
FYTO A 0 ACS_ExecuteAlways(998,0,1) 
FYTO A 7 A_WeaponReady(WRF_NOSWITCH)
goto Ready2
Ready2:
FYTO A 0 A_JumpIfInventory("Trigger2", 1, "Ready3")
FYTO A 7 A_WeaponReady(WRF_NOSWITCH)
FYTO A 0 A_GiveInventory("FlyAmmo", 2)
FYTO A 1 A_WeaponReady 
Goto Ready2
Ready3:
FYTO A 1 A_WeaponReady(WRF_NOSWITCH|WRF_NOSECONDARY)
Goto Ready2
Deselect:
TNT1 A 0 A_SelectWeapon("PhotonCannonWep")
TNT1 AAAAAAAAAAAAAAAAAAAAAA 0 A_Lower
TNT1 A 1 A_Lower
Loop
Select:
TNT1 AAAAAAAAAAAAAAAAAAAAAA 0 A_Raise
FYTO A 1 A_Raise
Loop
Fire: 
FYTO A 0 A_JumpIfNoAmmo("NoAmmo")
FYTO A 0 
Goto Hold
Hold:
FYTO A 0 A_JumpIfNoAmmo("NoAmmo")
FYTO A 0 A_JumpIfInventory("PhotonCharge",1,"Hold2")
FYTO A 3 A_GiveInventory("PhotonCharge",1)
BUST G 0 ACS_ExecuteAlways(994,0)
FYTO A 0 A_Refire
Goto Throw1
Hold2:
FYTO A 0 A_JumpIfInventory("PhotonCharge",2,"BotCheck")
FYTO A 0 A_GiveInventory("PhotonCharge",1)
FYTO B 3 
FYTO E 0 A_SpawnItemEx("PhotonFX")
FYTO A 0 A_Refire
Goto Throw1
BotCheck:
FYTO A 0 ACS_ExecuteAlways(974,0)
Goto Hold3
Hold3:
FYTO C 1 A_GiveInventory("PhotonCharge",1)
FYTO C 0 A_Refire
FYTO C 0 A_JumpIfInventory("PhotonCharge",78,"Throw3")
FYTO C 0 A_JumpIfInventory("PhotonCharge",33,"Throw2")
Goto Throw1
Throw1:
FYTO C 0 A_TakeInventory("PhotonCharge",100)
FYTO A 0 A_PlaySoundEx("weapon/pharaoh1","Weapon")
FYTO A 0 A_FireCustomMissile("PhotonCannon1",0,1,8,0)
FYTO DE 2
FYTO C 4 A_ClearRefire
FYTO A 2
Goto Ready+1
Throw2:
FYTO C 0 A_TakeInventory("PhotonCharge",100)
FYTO A 0 A_PlaySoundEx("weapon/pharaoh1","Weapon")
FYTO A 0 A_FireCustomMissile("PhotonCannon2",0,1,8,0)
FYTO C 0 A_Recoil(10)
FYTO DE 2
FYTO C 4 A_ClearRefire
FYTO A 2
Goto Ready+1
Throw3:
FYTO C 0 A_TakeInventory("PhotonCharge",100)
FYTO C 0 A_TakeInventory("PhotonCannonWepAmmo",3)
FYTO A 0 A_PlaySoundEx("weapon/pharaoh2","Weapon")
FYTO A 0 A_FireCustomMissile("PhotonCannon3",0,1,8,0)
FYTO C 0 A_Recoil(20)
FYTO DE 2
FYTO C 4 A_ClearRefire
FYTO A 2
Goto Ready+1
Goto Ready+1 // Go back to the ready state, but skip the color change/sound script.
NoAmmo: // This state is called in the firing frame if the player doesn't have enough ammo to fire it.
FYTO A 1 
Goto Ready+1 // Go back to the ready state, but skip the color change/sound script.
Altfire:
FYTO A 0 A_GiveInventory("Trigger",1)
FYTO A 0 A_GiveInventory("Trigger2",1)
FYTO A 1 A_JumpIfInventory("FlyAmmo", 1, "Fly")
goto Fall
Fly:
FYTO A 0 SetPlayerProperty(0, 1, 3)
FYTO A 5 A_TakeInventory("FlyAmmo",2)
GYAR A 0 A_ReFire
//GYAR A 1 A_WeaponReady
Goto Fall
Fall:
FYTO A 0 SetPlayerProperty(0, 0, 3)
FYTO A 0 A_TakeInventory("Trigger",999)
FYTO A 0 A_GunFlash
goto Ready2
Flash:
TNT1 A 1 A_JumpIf(z-floorz==0, "CanFlyAgain")
TNT1 A 0 A_JumpIf(momz==0, "momzverify")
loop
momzverify:
TNT1 A 1 A_JumpIf(z-floorz==0, "CanFlyAgain")
TNT1 A 0 A_JumpIf(momz==0, "CanFlyAgain")
goto Flash
CanFlyAgain:
TNT1 A 1 A_TakeInventory("Trigger2",999)
stop
NoFlash:
TNT1 A 0
stop
}
}

actor PhotonCannonWepAmmo : Ammo 
{
inventory.amount 1
inventory.maxamount 28 
}

actor PhotonCannon1
{
Obituary "%o was obliterated by %k's Photon Cannon." 
PROJECTILE
Radius 10
+DONTBLAST
Height 10
scale 2.5
damage (5)
damagetype "WeakPharoah"
speed 35
States
{
Spawn:
FYTO I 4
loop
Death:
FYTO I 0
stop
}
}

actor PhotonCannon2
{
Obituary "%o was obliterated by %k's Photon Cannon." 
PROJECTILE
Radius 20
+DONTBLAST
Height 20
scale 2.5
damage (20)
damagetype "WeakPharoah"
speed 35
States
{
Spawn:
FYTO J 4
loop
Death:
FYTO J 0
stop
}
}

actor PhotonCannon3
{
Obituary "%o was obliterated by %k's Photon Cannon." 
PROJECTILE
Radius 30
+DONTBLAST
Height 30
scale 2.5
damage (40)
damagetype "Pharoah"
speed 55
States
{
Spawn:
FYTO K 4
loop
Death:
FYTO K 0
stop
}
}

actor PhotonFX
{
+NOINTERACTION
-SOLID
+MISSILE
radius 1
height 1
+NOGRAVITY
renderstyle none
States
{
Spawn:
PLAY A 0
PLAY A 0 A_JumpIfInTargetInventory("PhotonCharge",78,"Give2")
PLAY A 0 A_JumpIfInTargetInventory("PhotonCharge",1,"Give")
stop
Give:
PLAY A 0 A_JumpIf(CallACS("core_targetexists")==0,"Death")
PLAY A 1 A_GiveToTarget("PhotonFXGive",1)
Goto Spawn
Give2:
PLAY A 0 A_JumpIf(CallACS("core_targetexists")==0,"Death")
PLAY A 1 A_GiveToTarget("PhotonFXGive2",1)
PLAY A 0 A_JumpIf(CallACS("core_targetexists")==0,"Death")
PLAY A 1 A_GiveToTarget("PhotonFXGive2",1)
PLAY A 0 A_JumpIf(CallACS("core_targetexists")==0,"Death")
PLAY A 1 A_GiveToTarget("PhotonFXGive2",1)
PLAY A 0 A_JumpIfInTargetInventory("PhotonCharge",78,"Give3")
stop
Give3:
PLAY A 0 A_JumpIf(CallACS("core_targetexists")==0,"Death")
PLAY A 1 A_GiveToTarget("PhotonFXGive3",1)
PLAY A 0 A_JumpIf(CallACS("core_targetexists")==0,"Death")
PLAY A 1 A_GiveToTarget("PhotonFXGive3",1)
PLAY A 0 A_JumpIf(CallACS("core_targetexists")==0,"Death")
PLAY A 1 A_GiveToTarget("PhotonFXGive3",1)
PLAY A 0 A_JumpIfInTargetInventory("PhotonCharge",78,"Give2")
stop
Death:
PLAY A 0
stop
}
}

actor PhotonFXGive : CustomInventory
{
inventory.amount 1
inventory.maxamount 1
+AUTOACTIVATE
states
{
Spawn:
TNT1 A 1
loop
Use:
TNT1 A 0 A_GiveInventory("PhotonCharge",0)
TNT1 A 0 A_JumpIfInventory("PhotonCharge", 69, "FX8")
TNT1 A 0 A_JumpIfInventory("PhotonCharge", 60, "FX7")
TNT1 A 0 A_JumpIfInventory("PhotonCharge", 51, "FX6")
TNT1 A 0 A_JumpIfInventory("PhotonCharge", 43, "FX5")
TNT1 A 0 A_JumpIfInventory("PhotonCharge", 33, "FX4")
TNT1 A 0 A_JumpIfInventory("PhotonCharge", 24, "FX3")
TNT1 A 0 A_JumpIfInventory("PhotonCharge", 15, "FX2")
TNT1 A 0 A_JumpIfInventory("PhotonCharge", 6, "FX1")
stop
FX1:
TNT1 A 0 //A_Print("FX1")
TNT1 A 0 A_SpawnItemEx("PhotonFX1",48,-2,40)
stop
FX2:
TNT1 A 0 A_SpawnItemEx("PhotonFX2",48,-2,40)
stop
FX3:
TNT1 A 0 //A_Print("FX3")
TNT1 A 0 A_SpawnItemEx("PhotonFX3",48,-2,40)
stop
FX4:
TNT1 A 0 A_SpawnItemEx("PhotonFX4",48,-2,40)
stop
FX5:
TNT1 A 0 A_SpawnItemEx("PhotonFX5",48,-2,40)
stop
FX6:
TNT1 A 0// A_Print("FX6")
TNT1 A 0 A_SpawnItemEx("PhotonFX6",48,-2,40)
stop
FX7:
TNT1 A 0 A_SpawnItemEx("PhotonFX7",48,-2,40)
stop
FX8:
TNT1 A 0// A_Print("FX8")
TNT1 A 0 A_SpawnItemEx("PhotonFX8",48,-2,40)
stop
}
}

actor PhotonFXGive2 : CustomInventory
{
inventory.amount 1
inventory.maxamount 1
+AUTOACTIVATE
states
{
Spawn:
TNT1 A 1
loop
Use:
TNT1 A 0 A_SpawnItemEx("PhotonFX9",48,-2,40)
stop
}
}

actor PhotonFXGive3 : CustomInventory
{
inventory.amount 1
inventory.maxamount 1
+AUTOACTIVATE
states
{
Spawn:
TNT1 A 1
loop
Use:
TNT1 A 0 A_SpawnItemEx("PhotonFX10",48,-2,40)
stop
}
}

actor PhotonFX1
{
+CLIENTSIDEONLY
-SOLID
+NOGRAVITY
Scale 2.5
States
{
Spawn:
FYTO F 2
stop
}
}

actor PhotonFX2 : PhotonFX1
{
States
{
Spawn:
FYTO F 2
stop
}
}

actor PhotonFX3 : PhotonFX1
{
States
{
Spawn:
FYTO F 2
stop
}
}

actor PhotonFX4 : PhotonFX1
{
States
{
Spawn:
FYTO G 2
stop
}
}

actor PhotonFX5 : PhotonFX1
{
States
{
Spawn:
FYTO G 2
stop
}
}

actor PhotonFX6 : PhotonFX1
{
States
{
Spawn:
FYTO G 2
stop
}
}

actor PhotonFX7 : PhotonFX1
{
States
{
Spawn:
FYTO H 2
stop
}
}

actor PhotonFX8 : PhotonFX1
{
States
{
Spawn:
FYTO H 2
stop
}
}

actor PhotonFX9 : PhotonFX1
{
States
{
Spawn:
FYTO H 2
stop
}
}

actor PhotonFX10 : PhotonFX1
{
-CLIENTSIDEONLY
damagetype "PharaohHold"
States
{
Spawn:
FYTO GH 0
FYTO GH 2 A_Explode(3,48,0)
stop
}
}

actor PhotonCharge : Inventory
{
inventory.amount 1
inventory.maxamount 78
}

actor FlyAmmo : Ammo
{
inventory.amount 1
inventory.maxamount 64
}

actor Trigger : Ammo
{
inventory.amount 1
inventory.maxamount 1
}

actor Trigger2 : Ammo
{
inventory.amount 1
inventory.maxamount 1
}