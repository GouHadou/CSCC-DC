actor AnkhzirusBandageBoss : AnkhzirusStaffBoss
{
Inventory.Pickupmessage "Power Up! Coding Hell Bandage!"
inventory.pickupsound "weapon/weaponup"
inventory.icon "WIRE"
Tag "Ancient Bindings"
Weapon.SlotNumber 2
+WEAPON.AMMO_OPTIONAL
Scale 2.0
States
{
Fire:
PHAN B 0 A_TakeInventory("KnightFlag",800)
PHAN B 0 A_PlaySoundEx("weapon/magnetmissile","Weapon")
PHAN B 0 A_GiveInventory("KnightFlag",1)
PHAN B 10 A_FireCustomMissile("AnkhzirusGrapple",0,0,8,0)
FireLoop:
PHAN B 1 A_GiveInventory("KnightFlag",1)
PHAN B 0 A_JumpIfInventory("KnightFlag",140,"FireEnd")
loop
FireEnd:
PHAN B 0 A_TakeInventory("KnightFlag",999)
PHAN B 0 A_TakeInventory("PowerAnkhzirusSelfSlow",1)
PHAN B 0 A_GiveInventory("AnkhzirusJumpLimit",1)
PHAN B 0 A_GunFlash
PHAN B 10 A_JumpIfInventory("AnkhzirusJumpLimit",5,"FireEndLoop")
goto Ready+1
FireEndLoop:
PHAN B 0 A_GiveInventory("KnightFlag",1)
PHAN B 0 A_JumpIfInventory("KnightFlag",105,"FireEndEnd")
PHAN B 1 A_JumpIf(z-floorz==0,1)
loop
FireEndEnd:
PHAN B 0 A_TakeInventory("KnightFlag",999)
goto Ready+1
AltFire:
PHAN B 0 A_TakeInventory("KnightFlag",800)
PHAN B 0 A_PlaySoundEx("weapon/magnetmissile","Weapon")
PHAN B 0 A_GiveInventory("KnightFlag",1)
PHAN B 0 A_FireCustomMissile("AnkhzirusCurser",5,0,-8,0)
PHAN B 10 A_FireCustomMissile("AnkhzirusCurserRight",-5,0,8,0)
AltLoop:
PHAN B 1 A_GiveInventory("KnightFlag",1)
PHAN B 0 A_JumpIfInventory("KnightFlag",140,"AltFireEnd")
PHAN B 0 A_JumpIfInventory("AnkhzirusCurseLeftFlag",1,1)
loop
PHAN B 0 A_JumpIfInventory("AnkhzirusCurseRightFlag",1,1)
goto AltLoop
AltFireEnd:
PHAN B 0 A_TakeInventory("KnightFlag",999)
PHAN B 0 A_TakeInventory("AnkhzirusCurseLeftFlag",1)
PHAN B 10 A_TakeInventory("AnkhzirusCurseRightFlag",1)
goto Ready+1
Flash:
TNT1 A 1 A_JumpIf(z-floorz==0,1)
loop
TNT1 A 0 A_TakeInventory("AnkhzirusJumpLimit",5)
stop
Deselect:
TNT1 AAAAAAAAAAAAAAAAAAAAAA 0 A_Lower
PHAN A 1 A_Lower
PHAN A 0 A_SelectWeapon("AnkhzirusStaffBoss")
Loop
}}

actor AnkhzirusJumpLimit : Inventory
{
inventory.amount 1
inventory.maxamount 5
}

actor AnkhzirusCurseLeftFlag : Inventory
{
inventory.amount 1
inventory.maxamount 1
}

actor AnkhzirusCurseRightFlag : Inventory
{
inventory.amount 1
inventory.maxamount 1
}

actor AnkhzirusGrapple
{
PROJECTILE
+DONTREFLECT
+NOTARGETSWITCH
-HITTRACER
+MTHRUSPECIES
damagetype "AnkhzirusGrab"
Obituary "$OB_ANKHGRAPPLE"
var int user_PTID;
var int user_flyloops;
ReactionTime 5
Speed 55
Damage (5)
radius 5
height 5
scale 2.5
States
{
Spawn:
WADP B 0
WADP B 0 A_SetUserVar("user_PTID",ACS_ExecuteWithResult(257,0))
WADP B 0 Thing_ChangeTID(0,user_PTID+1700)
WADP B 0 A_SetUserVar("user_flyloops",4)
FlyLoop:
WADP B 0 A_GiveInventory("CutterFlag",1)
WAD1 AAAA 1 ACS_NamedExecuteAlways("Ankhzirus_GrappleTrail",0,user_PTID)
WAD1 A 0 A_ScaleVelocity(0.5)
WADI A 0 A_JumpIfInventory("CutterFlag",user_flyloops,"Bye")
loop
Bye:
WAD1 A 1 A_FaceTarget
WAD1 A 0 A_SpawnItemEx("AnkhzirusGrappleReturn",0,0,0)//A_CustomMissile("AnkhzirusGrappleReturn", 0, 0, 0, 0)
stop
Crash:
TNT1 A 2
TNT1 A 1 A_JumpIfInTargetInventory("AnkhzirusGrabID",1,"Grab")
TNT1 A 0
goto Bye
Grab:
WADP A 0 A_GiveToTarget("AnkhzirusGrabSelfSlow",1)
stop
Death:
WADP B 0 ACS_NamedExecuteAlways("core_hookshot",0,user_PTID,3,0)
WAD1 B 3
goto DeathLoop1
DeathLoop1:
WADP B 0 A_JumpIfCloser(64,"Vanish")
WADP B 0 A_GiveInventory("KnightFlag",1)
WADP B 0 A_JumpIfInventory("KnightFlag",35,"Vanish")
WADP B 0 A_GiveToTarget("WireHookShotDelay",1)
WADP B 0 ACS_NamedExecute("Ankhzirus_GrappleTrail",0,user_PTID)
WAD1 B 1 A_JumpIf(ACS_NamedExecuteWithResult("core_targetexists")==0,"Vanish")
loop
Vanish:
TNT1 A 0 A_GiveToTarget("KnightFlag",800)
TNT1 A 5 A_TakeFromTarget("WireAdaptorDelay",1)
stop
}}

actor AnkhzirusCurser : AnkhzirusGrapple
{
Obituary "$OB_ANKHCURSE"
Damage (10)
Speed 60
DamageType "AnkhzirusCurse"
States
{
Spawn:
WADP B 0
WADP B 0 A_SetUserVar("user_PTID",ACS_ExecuteWithResult(257,0))
WADP B 0 Thing_ChangeTID(0,user_PTID+1700)
WADP B 0 A_SetUserVar("user_flyloops",7)
goto FlyLoop
Crash:
Death:
TNT1 A 0 A_Jump(256,"Bye")
goto Bye
Bye:
WAD1 A 1 A_FaceTarget
WAD1 A 0 A_SpawnItemEx("AnkhzirusGrappleReturnLeft",0,0,0)//A_CustomMissile("AnkhzirusGrappleReturn", 0, 0, 0, 0)
stop
}}

actor AnkhzirusCurserRight : AnkhzirusCurser
{
States
{
Bye:
WAD1 A 1 A_FaceTarget
WAD1 A 0 A_SpawnItemEx("AnkhzirusGrappleReturnRight",0,0,0)//A_CustomMissile("AnkhzirusGrappleReturn", 0, 0, 0, 0)
stop
}}

Actor AnkhzirusGrappleReturn
{
+MISSILE
+NOINTERACTION
+RIPPER
+NOTARGETSWITCH
+NOCLIP
Speed 30
Damage (0)
Scale 2.5
States
{
Spawn:
TNT1 A 0 
WAD1 B 0 ACS_NamedExecuteAlways("Ankhzirus_GrappleTrail",0,-1)
WAD1 B 1 A_FaceTarget
TNT1 A 0 A_JumpIfCloser(64, "Death")
TNT1 A 0 A_CustomMissile("AnkhzirusGrappleReturn", 0, 0, 0, 0)
TNT1 A 1
stop
Death:
TNT1 A 2 A_GiveToTarget("KnightFlag",800)
stop
}
}

actor AnkhzirusGrappleReturnLeft : AnkhzirusGrappleReturn
{
States
{
Spawn:
TNT1 A 0 
WAD1 B 0 ACS_NamedExecuteAlways("Ankhzirus_GrappleTrail",0,-1)
WAD1 B 1 A_FaceTarget
TNT1 A 0 A_JumpIfCloser(64, "Death")
TNT1 A 0 A_CustomMissile("AnkhzirusGrappleReturnLeft", 0, 0, 0, 0)
TNT1 A 1
stop
Death:
TNT1 A 2 A_GiveToTarget("AnkhzirusCurseLeftFlag",1)
stop
}
}

actor AnkhzirusGrappleReturnRight : AnkhzirusGrappleReturn
{
States
{
Spawn:
TNT1 A 0 
WAD1 B 0 ACS_NamedExecuteAlways("Ankhzirus_GrappleTrail",0,-1)
WAD1 B 1 A_FaceTarget
TNT1 A 0 A_JumpIfCloser(64, "Death")
TNT1 A 0 A_CustomMissile("AnkhzirusGrappleReturnRight", 0, 0, 0, 0)
TNT1 A 1
stop
Death:
TNT1 A 2 A_GiveToTarget("AnkhzirusCurseRightFlag",1)
stop
}
}

Actor AnkhzirusGrappleDamage
{
PROJECTILE
Obituary "$OB_ANKHGRAPPLE"
Speed 0
Damage (15)
Height 1
Radius 1
States
{
Spawn:
TNT1 A 2
stop
}
}

actor AnkhzirusGrappleHit
{
+NOCLIP
+NOGRAVITY
radius 1
height 1
states
{
Spawn:
TNT1 A 0
TNT1 A 0 A_GiveToTarget("AnkhzirusGrappleHitPickup")
stop
}
}

actor AnkhzirusGrappleHitPickup : CustomInventory
{
+INVENTORY.AUTOACTIVATE
+INVENTORY.IGNORESKILL
Inventory.Amount 1
Inventory.MaxAmount 1
States
{
Pickup:
TNT1 A 0 A_GiveInventory("AnkhzirusGrabSlow",1)
TNT1 A 0 A_GiveToTarget("AnkhzirusGrabID",tid)
TNT1 A 0 A_GiveToTarget("AnkhzirusGrappleHitConfirm",1)
stop
}
}

actor AnkhzirusGrappleHitConfirm : AnkhzirusGrappleHitPickup
{
States
{
Pickup:
TNT1 A 0 ACS_NamedExecute("Ankhzirus_Grab",0)
stop
}
}

actor AnkhzirusGrabID : Inventory
{
Inventory.Amount 1
Inventory.MaxAmount 9999
+INVENTORY.IGNORESKILL
}

actor AnkhzirusGrabSlow : PowerupGiver
{
Speed 0.0
powerup.duration 75
powerup.type "AnkhzirusSlow"
+INVENTORY.AUTOACTIVATE
+INVENTORY.ALWAYSPICKUP
states
{
Pickup:
TNT1 A 0 

TNT1 A 175
stop
}
}

actor PowerAnkhzirusSlow : PowerSpeed
{
Speed 0.2
Powerup.Color "55 55 55", 0.6
}

actor AnkhzirusGrabSelfSlow : PowerupGiver
{
Speed 0.0
powerup.duration 75
powerup.type "AnkhzirusSelfSlow"
+INVENTORY.AUTOACTIVATE
+INVENTORY.ALWAYSPICKUP
states
{
Pickup:
TNT1 A 0 

TNT1 A 175
stop
}
}

actor PowerAnkhzirusSelfSlow : PowerSpeed
{
Speed 0.6
}

actor AnkhzirusCurseAttack : PowerupGiver
{
powerup.duration 140
powerup.type "PowerAnkhzirusCurseAttack"
+INVENTORY.AUTOACTIVATE
+INVENTORY.ALWAYSPICKUP
states
{
Pickup:
TNT1 A 0 
TNT1 A 175
stop
}
}

actor PowerAnkhzirusCurseAttack : PowerDamage
{
damagefactor "normal", 0.7
Powerup.Color "25 25 25", 0.7
}

actor AnkhzirusCurseDefense : PowerupGiver
{
powerup.duration 140
powerup.type "PowerAnkhzirusCurseDefense"
+INVENTORY.AUTOACTIVATE
+INVENTORY.ALWAYSPICKUP
states
{
Pickup:
TNT1 A 0 
TNT1 A 175
stop
}
}

actor PowerAnkhzirusCurseDefense : PowerProtection
{
damagefactor "normal", 1.3
}

actor AnkhzirusCurseWatcher
{
Height 0
Radius 0
+NOINTERACTION
-SOLID
+NOGRAVITY
+MISSILE
States
{
Spawn:
TNT1 A 0 
TNT1 A 0 A_GiveToTarget("AnkhzirusCurseDefense",1)
TNT1 A 0 A_GiveToTarget("AnkhzirusCurseAttack",1)
CurseLoop:
TNT1 A 3 A_GiveToTarget("AnkhzirusCurseFX", 1)
TNT1 A 0 A_JumpIfInTargetInventory("PowerAnkhzirusCurseDefense", 1, "CurseLoop")
stop
}
}

actor AnkhzirusCurseFX : CustomInventory
{
+INVENTORY.AUTOACTIVATE
-INVBAR
States
{
Use:
TNT1 A 0
TNT1 A 0 A_SpawnItemEx("AnkhzirusCurseGFX", random(16, 48), 0, Random(16,48), 0, 0, 0, random(0, 359))
stop
}
}

actor AnkhzirusCurseGFX : TimeSlowGFX
{
States
{
Spawn:
DESB ABCB 2 A_FadeOut(0.1)
loop
}
}
