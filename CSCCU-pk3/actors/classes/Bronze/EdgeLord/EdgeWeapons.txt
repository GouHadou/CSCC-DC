const int TELEPORT_COST = 12;
const int BURST_MIN_CHARGE = 25;

actor EdgeWeaponBase : Weapon //Waiting for a weapon base
{
//====================
Inventory.Pickupmessage "Nani?!"
inventory.pickupsound "weapon/weaponup"
Scale 2.0
+WEAPON.AMMO_OPTIONAL
+WEAPON.ALT_AMMO_OPTIONAL
+WEAPON.DONTBOB
+WEAPON.ALLOW_WITH_RESPAWN_INVUL
//====================
dropitem "StepKatanaWepCDropped"
Weapon.AmmoType "TeleportsBehindYouAmmo"
Weapon.AmmoType2 "DarkPowerAmmo"

Weapon.AmmoUse 0
Weapon.AmmoUse2 0
states
{
Spawn:
EDGA B 1
loop
Ready:
TNT1 A 0 ACS_ExecuteAlways(998,0,DYE_EDGELORD)
TNT1 A 0 A_GunFlash
goto AltFireCDCheck
SuperReady2:
EDGH L 1 A_JumpIfInventory("EdgeLordFlag",1,"Ready2")
//EDGH L 1 A_Jump(256,"Ready2")
loop
AltFire:
TNT1 A 0 A_TakeInventory("EdgeWaitFlag",100)
TNT1 A 0 A_SpawnItemEx("EdgeTeleportFXOut")
//TNT1 A 0 A_ChangeVelocity(cos(pitch)*400,0,-sin(pitch)*200,CVF_RELATIVE|CVF_REPLACE)
TNT1 A 0 A_ChangeVelocity(400*cos(pitch)*(1-abs(sin(pitch))/2),0,400*-sin(pitch)*(1-abs(sin(pitch))/2),CVF_RELATIVE|CVF_REPLACE)
TNT1 A 0 A_TakeInventory("TeleportsBehindYouAmmo",TELEPORT_COST)
EDGH L 1 A_GiveInventory("TeleportChargePickup",1)
TNT1 A 0 A_Stop
TNT1 A 0 A_SpawnItemEx("EdgeTeleportFXIn")
TNT1 A 0 A_GiveInventory("EdgeTeleSpeedPowerup1",1)
TNT1 A 0 A_GiveInventory("EdgeTeleSpeedPowerup2",1)
TNT1 A 0 A_GiveInventory("EdgeTeleportWaitFlag",5)
AltFireCD:
TNT1 A 0 A_GiveInventory("TeleportChargePickup",1)
TNT1 A 0 A_TakeInventory("EdgeTeleportWaitFlag",1)
EDGH L 1 A_WeaponReady(WRF_NOFIRE)
AltFireCDCheck:
TNT1 A 0 A_JumpIfInventory("EdgeTeleportWaitFlag",1,"AltFireCD")
goto SuperReady2
Fire:
Select:
Deselect:
TNT1 A 1
loop
Flash:
TNT1 A 0 A_JumpIfInventory("EdgeBurstIsCharging",1,"FlashCharge")
TNT1 A 0 A_JumpIfInventory("EdgeBurstCooldown",1,"FlashBurstCooldown")
Flash2:
TNT1 A 1 A_JumpIfInventory("PowerUseEdgeBurst",1,"FlashChargeStart")
loop
FlashChargeStart:
TNT1 A 0 A_TakeInventory("EdgeBurstCharge",999)
TNT1 A 0 A_GiveInventory("EdgeBurstIsCharging",1)
TNT1 A 0 A_GiveInventory("EdgeBurstChargePickup",1)
EDGH M 1
FlashCharge:
TNT1 A 0 A_GiveInventory("EdgeBurstChargePickup",1)
TNT1 A 0 A_JumpIfInventory("EdgeBurstCharge",BURST_MIN_CHARGE,"FlashCharge2b")
TNT1 A 0 A_JumpIfHealthLower(1,"FlashBurstDied")
TNT1 A 0 A_SpawnItemEx("EdgeBurstChargeFXSpawn",random(256,-256),random(256,-256),random(256,-256))
EDGH N 1
TNT1 A 0 A_GiveInventory("EdgeBurstChargePickup",1)
TNT1 A 0 A_JumpIfInventory("EdgeBurstCharge",BURST_MIN_CHARGE,"FlashCharge2b")
TNT1 A 0 A_JumpIfHealthLower(1,"FlashBurstDied")
TNT1 A 0 A_SpawnItemEx("EdgeBurstChargeFXSpawn",random(256,-256),random(256,-256),random(256,-256))
EDGH O 1
loop
FlashCharge2:
TNT1 A 0 A_GiveInventory("EdgeBurstChargePickup",1)
FlashCharge2b:
TNT1 A 0 A_JumpIfInventory("PowerUseEdgeBurst",1,"FlashBurst")
TNT1 A 0 A_JumpIfHealthLower(1,"FlashBurstDied")
TNT1 A 0 A_SpawnItemEx("EdgeBurstChargeFXSpawn",random(256,-256),random(256,-256),random(256,-256))
EDGH O 1
TNT1 A 0 A_GiveInventory("EdgeBurstChargePickup",1)
TNT1 A 0 A_JumpIfInventory("PowerUseEdgeBurst",1,"FlashBurst")
TNT1 A 0 A_JumpIfHealthLower(1,"FlashBurstDied")
TNT1 A 0 A_SpawnItemEx("EdgeBurstChargeFXSpawn",random(256,-256),random(256,-256),random(256,-256))
EDGH P 1
TNT1 A 0 A_GiveInventory("EdgeBurstChargePickup",1)
TNT1 A 0 A_JumpIfInventory("PowerUseEdgeBurst",1,"FlashBurst")
TNT1 A 0 A_JumpIfHealthLower(1,"FlashBurstDied")
TNT1 A 0 A_SpawnItemEx("EdgeBurstChargeFXSpawn",random(256,-256),random(256,-256),random(256,-256))
EDGH Q 1
goto FlashCharge2
FlashBurst:
TNT1 A 0 A_TakeInventory("EdgeBurstIsCharging",1)
TNT1 A 0 A_GiveInventory("DarkPowerLockout",1)
//TNT1 AAAAAAAAAA 0 A_SpawnItemEx("CentaurFlashFX", 0, 0, 28, 256/12, 0, random2(256/12), random(0, 359))
//TNT1 AAAAAAAAAA 0 A_SpawnItemEx("CentaurFlashFX", 0, 0, 28, 256/12, 0, random2(256/12), random(0, 359))
//TNT1 A 0 A_PlaySoundEx("weapon/centaurflash","Weapon")
TNT1 AAAAAAAAAA 0 A_SpawnItemEx("EdgeBurstFX", 0, 0, 28, 256/12, 0, random2(256/12), random(0, 359))
TNT1 AAAAAAAAAA 0 A_SpawnItemEx("EdgeBurstFX", 0, 0, 28, 256/12, 0, random2(256/12), random(0, 359))
TNT1 A 0 A_PlaySoundEx("weapon/napalm","Weapon")
TNT1 A 0 A_FireCustomMissile("EdgeBurst",0,0,-8,0)
TNT1 A 0 A_GiveInventory("DarkPowerLockout",9)
TNT1 A 0 A_GiveInventory("EdgeBurstCooldown",100)
EDGH RRRRNN 1 A_GiveInventory("EdgeBurstCooldownPickup",1)
FlashBurstCooldown:
TNT1 A 0 A_GiveInventory("EdgeBurstCooldownPickup",1)
EDGH M 1
TNT1 A 0 A_JumpIfInventory("EdgeBurstCooldown",1,"FlashBurstCooldown")
goto Flash2
FlashBurstDied:
TNT1 A 0 A_TakeInventory("EdgeBurstIsCharging",1)
goto FlashBurstCooldown
}
}

actor EdgeGunBoss : EdgeWeaponBase
{
Weapon.SlotNumber 1
inventory.icon "EdgeGunI"
Obituary "$OB_EDGEGUN"
states
{
Ready2:
TNT1 A 0 A_GiveInventory("TeleportChargePickup",1)
TNT1 A 0 A_JumpIfInventory("TeleportsBehindYouAmmo",TELEPORT_COST,"Ready3b")
EDGH A 1 A_WeaponReady(WRF_NOSECONDARY)
loop
Ready3:
TNT1 A 0 A_GiveInventory("TeleportChargePickup",1)
Ready3b:
EDGH A 1 A_WeaponReady
goto Ready3
Deselect:
TNT1 AAAAAAAAAAAAAAAAAAAAAA 0 A_Lower
EDGH A 1 A_Lower
Loop
Select:
TNT1 AAAAAAAAAAAAAAAAAAAAAA 0 A_Raise
EDGH A 1 A_Raise
Loop
Fire:
TNT1 A 0 A_GiveInventory("EdgeWaitFlag",6)
FireSpread0:
//TNT1 A 0 A_FireCustomMissile("EdgeGunShot",0,0,8,0)
TNT1 A 0 A_FireCustomMissile("EdgeGunShot2",0,0,8,0)
goto Fire1
FireSpread1:
TNT1 A 0 A_FireCustomMissile("EdgeGunShot",random(-1,1),0,8,0)
goto Fire1
FireSpread2:
TNT1 A 0 A_FireCustomMissile("EdgeGunShot",random(-2,2),0,8,0)
goto Fire1
FireSpread3:
TNT1 A 0 A_FireCustomMissile("EdgeGunShot",random(-3,3),0,8,0)
goto Fire1
FireSpread4:
TNT1 A 0 A_FireCustomMissile("EdgeGunShot",random(-4,4),0,8,0)
goto Fire1
Fire1:
TNT1 A 0 A_PlaySoundEx("weapon/mbuster","Weapon")
TNT1 A 0 A_GiveInventory("TeleportChargePickup",1)
TNT1 A 0 A_JumpIf((ACS_NamedExecuteWithResult("Edge_Count_TeleportAmmo")<TELEPORT_COST),2)
TNT1 A 0 A_WeaponReady(WRF_NOPRIMARY|WRF_NOSWITCH)
EDGH A 1
TNT1 A 0 A_GiveInventory("TeleportChargePickup",1)
TNT1 A 0 A_JumpIf((ACS_NamedExecuteWithResult("Edge_Count_TeleportAmmo")<TELEPORT_COST),2)
TNT1 A 0 A_WeaponReady(WRF_NOPRIMARY|WRF_NOSWITCH)
EDGH B 1
TNT1 A 0 A_GiveInventory("TeleportChargePickup",1)
TNT1 A 0 A_JumpIf((ACS_NamedExecuteWithResult("Edge_Count_TeleportAmmo")<TELEPORT_COST),2)
TNT1 A 0 A_WeaponReady(WRF_NOPRIMARY|WRF_NOSWITCH)
EDGH C 1
TNT1 A 0 A_TakeInventory("EdgeWaitFlag",1)
TNT1 A 0 A_JumpIfInventory("EdgeWaitFlag",5,"FireSpread1")
TNT1 A 0 A_JumpIfInventory("EdgeWaitFlag",4,"FireSpread2")
TNT1 A 0 A_JumpIfInventory("EdgeWaitFlag",3,"FireSpread3")
TNT1 A 0 A_JumpIfInventory("EdgeWaitFlag",1,"FireSpread4")
goto FireEnd
FireEnd:
TNT1 A 0 A_GiveInventory("EdgeWaitFlag",33)
goto FireEnd1
FireEnd1:
TNT1 A 0 A_GiveInventory("TeleportChargePickup",1)
TNT1 A 0 A_JumpIf((ACS_NamedExecuteWithResult("Edge_Count_TeleportAmmo")<TELEPORT_COST),2)
TNT1 A 0 A_WeaponReady(WRF_NOPRIMARY|WRF_NOSWITCH)
EDGH C 1
TNT1 A 0 A_TakeInventory("EdgeWaitFlag",1)
TNT1 A 0 A_JumpIfInventory("EdgeWaitFlag",1,"FireEnd1")
TNT1 A 0 A_GiveInventory("TeleportChargePickup",1)
TNT1 A 0 A_JumpIf((ACS_NamedExecuteWithResult("Edge_Count_TeleportAmmo")<TELEPORT_COST),2)
TNT1 A 0 A_WeaponReady(WRF_NOPRIMARY|WRF_NOSWITCH)
EDGH D 1
TNT1 A 0 A_GiveInventory("TeleportChargePickup",1)
TNT1 A 0 A_JumpIf((ACS_NamedExecuteWithResult("Edge_Count_TeleportAmmo")<TELEPORT_COST),2)
TNT1 A 0 A_WeaponReady(WRF_NOPRIMARY|WRF_NOSWITCH)
EDGH D 1
goto Ready2
}
}

actor EdgeBladeBoss : EdgeWeaponBase
{
Weapon.SlotNumber 2
inventory.icon "EdgeSwdI"
Obituary "$OB_EDGEKATANA"
states
{
Ready2:
TNT1 A 0 A_GiveInventory("TeleportChargePickup",1)
TNT1 A 0 A_JumpIfInventory("TeleportsBehindYouAmmo",TELEPORT_COST,"Ready3b")
EDGH E 1 A_WeaponReady(WRF_NOSECONDARY)
loop
Ready3:
TNT1 A 0 A_GiveInventory("TeleportChargePickup",1)
Ready3b:
EDGH E 1 A_WeaponReady
goto Ready3
Deselect:
TNT1 AAAAAAAAAAAAAAAAAAAAAA 0 A_Lower
EDGH E 1 A_Lower
Loop
Select:
TNT1 AAAAAAAAAAAAAAAAAAAAAA 0 A_Raise
EDGH E 1 A_Raise
Loop
Fire:
TNT1 A 0 A_PlaySoundEx("weapon/slashclaw","Weapon")
TNT1 A 0 A_FireCustomMissile("EdgeBladeSlash",0,0,8,0)
EDGH FGHIJ 1 A_GiveInventory("TeleportChargePickup",1)
TNT1 A 0 A_GiveInventory("EdgeWaitFlag",20)
FireEnd1:
TNT1 A 0 A_GiveInventory("TeleportChargePickup",1)
TNT1 A 0 A_JumpIf((ACS_NamedExecuteWithResult("Edge_Count_TeleportAmmo")<TELEPORT_COST),2)
TNT1 A 0 A_WeaponReady(WRF_NOPRIMARY|WRF_NOSWITCH)
EDGH J 1
TNT1 A 0 A_TakeInventory("EdgeWaitFlag",1)
TNT1 A 0 A_JumpIfInventory("EdgeWaitFlag",1,"FireEnd1")
TNT1 A 0 A_GiveInventory("EdgeWaitFlag",4)
FireEnd2:
TNT1 A 0 A_GiveInventory("TeleportChargePickup",1)
TNT1 A 0 A_JumpIf((ACS_NamedExecuteWithResult("Edge_Count_TeleportAmmo")<TELEPORT_COST),2)
TNT1 A 0 A_WeaponReady(WRF_NOPRIMARY|WRF_NOSWITCH)
TNT1 A 1
TNT1 A 0 A_TakeInventory("EdgeWaitFlag",1)
TNT1 A 0 A_JumpIfInventory("EdgeWaitFlag",1,"FireEnd2")

TNT1 A 0 A_GiveInventory("TeleportChargePickup",1)
TNT1 A 0 A_JumpIf((ACS_NamedExecuteWithResult("Edge_Count_TeleportAmmo")<TELEPORT_COST),2)
TNT1 A 0 A_WeaponReady(WRF_NOPRIMARY|WRF_NOSWITCH)
EDGH K 1
TNT1 A 0 A_GiveInventory("TeleportChargePickup",1)
TNT1 A 0 A_JumpIf((ACS_NamedExecuteWithResult("Edge_Count_TeleportAmmo")<TELEPORT_COST),2)
TNT1 A 0 A_WeaponReady(WRF_NOPRIMARY|WRF_NOSWITCH)
EDGH K 1
TNT1 A 0 A_GiveInventory("TeleportChargePickup",1)
TNT1 A 0 A_JumpIf((ACS_NamedExecuteWithResult("Edge_Count_TeleportAmmo")<TELEPORT_COST),2)
TNT1 A 0 A_WeaponReady(WRF_NOPRIMARY|WRF_NOSWITCH)
EDGH E 1
TNT1 A 0 A_GiveInventory("TeleportChargePickup",1)
TNT1 A 0 A_JumpIf((ACS_NamedExecuteWithResult("Edge_Count_TeleportAmmo")<TELEPORT_COST),2)
TNT1 A 0 A_WeaponReady(WRF_NOPRIMARY|WRF_NOSWITCH)
EDGH E 1
Goto Ready2
}
}

actor EdgeTeleSpeedPowerup : PowerSpeed
{
+POWERSPEED.NOTRAIL
}

actor EdgeTeleSpeedPowerup1 : EdgeTeleSpeedPowerup
{
powerup.duration 2
Speed 6.0
}

actor EdgeTeleSpeedPowerup2 : EdgeTeleSpeedPowerup
{
powerup.duration 10
Speed 2.0
}

actor EdgeGunShot : FastProjectileBase
{
damagetype "EdgeGun"
Obituary "$OB_EDGEGUN"
Speed 77
Damage (4)
radius 5
height 5
States
{
Spawn:
EDGA D 1
loop
Death:
TNT1 A 0 
stop
}
}

actor EdgeGunShot2 : EdgeGunShot
{
Damage (7)
translation "3:5=[136,20,0]:[136,20,0]", "30:100=[68,68,68]:[68,68,68]"
}

actor EdgeBladeSlash : ProjectileBase
{
Radius 5
Height 5
damage (0)
+RIPPER
damagetype "EdgeBlade"
Obituary "$OB_EDGEKATANA"
speed 15
//translation "100:120=41:41", "210:220=93:93"
translation "100:120=[136,20,0]:[136,20,0]", "210:220=[68,68,68]:[68,68,68]"
States
{
Spawn:
SCLA H 0
SCLA HIJKL 1 A_Explode(9,80,0)
stop
Death:
TNT1 A 0 
stop
}
}

actor EdgeBurst : BasicExplosion
{
damagetype "EdgeBurst"
Obituary "$OB_EDGEBURST"
States
{
Spawn:
TNT1 A 0
TNT1 A 1 A_Explode(ACS_NamedExecuteWithResult("Edge_Count_Target_BurstCharge")/3,ACS_NamedExecuteWithResult("Edge_Count_Target_BurstCharge")*10,0,0,ACS_NamedExecuteWithResult("Edge_Count_Target_BurstCharge")*1)
stop
}
}

actor EdgeBurstFX : BasicClientSide
{
+FORCEXYBILLBOARD
height 0
radius 0
States
{
Spawn:
TNT1 A 0
EDGA HGFE 3
stop
}
}

actor EdgeBurstChargeFXSpawn : BasicClientSide
{
+MISSILE
States
{
Spawn:
TNT1 A 0
TNT1 A 1 A_CustomMissile("EdgeBurstChargeFX",0,0,0,0)
stop
}
}

actor EdgeBurstChargeFX : BasicClientSide
{
PROJECTILE
speed 30
states
{
Spawn:
EDGA EFEF 2
stop
}
}

actor EdgeWaitFlag : Inventory
{
inventory.amount 1
inventory.maxamount 100
}

actor EdgeTeleportWaitFlag : Inventory
{
inventory.amount 1
inventory.maxamount 35
}

actor TeleportChargePickup : CustomInventory
{
states
{
Pickup:
TNT1 A 0 A_JumpIfInventory("TeleportsBehindYouAmmo",28,"PickupNo")
TNT1 A 0 A_GiveInventory("TeleportsBehindYouSubAmmo",1)
TNT1 A 0 A_JumpIfInventory("TeleportsBehindYouSubAmmo",10,"Pickup2")
stop
Pickup2:
TNT1 A 0 A_TakeInventory("TeleportsBehindYouSubAmmo",10)
TNT1 A 0 A_GiveInventory("TeleportsBehindYouAmmo",1)
stop
PickupNo:
TNT1 A 0 A_TakeInventory("TeleportsBehindYouSubAmmo",99)
stop
}
}

actor EdgeTeleportFX : BasicClientSide
{
//+MISSILE
height 0
radius 0
translation "192:192=[136,20,0]:[136,20,0]", "198:198=[68,68,68]:[68,68,68]"
}

actor EdgeTeleportFXOut : EdgeTeleportFX
{
States
{
Spawn:
TNT1 A 0
TNT1 A 0 A_PlaySoundEx("misc/darkthrow","Weapon")
//TNT1 A 1 Thing_SetTranslation(0, ACS_NamedExecuteWithResult("core_copytranslation"))
TFOG CBA 2
stop
}
}

actor EdgeTeleportFXIn : EdgeTeleportFX
{
States
{
Spawn:
TNT1 A 0
//TNT1 A 1 Thing_SetTranslation(0, ACS_NamedExecuteWithResult("core_copytranslation"))
TFOG ABC 2
TNT1 A 0 A_PlaySoundEx("misc/darkthrow","Weapon")
stop
}
}

actor EdgeBurstItem : CustomInventory
{
inventory.icon "EdgeBrsI"
inventory.amount 1
inventory.maxamount 1
+INVBAR
States
{
Use:
//TNT1 A 0 A_GiveInventory("PowerUseEdgeBurst",1)
TNT1 A 0 A_GiveInventory("PowerUseEdgeBurstGiver",1)
fail
}
}

actor EdgeBurstChargePickup : CustomInventory
{
states
{
Pickup:
TNT1 A 0 A_JumpIfInventory("DarkPowerAmmo",1,"Pickup2")
TNT1 A 0 A_GiveInventory("CutSelfOnEdge",1)
stop
Pickup2:
TNT1 A 0 A_TakeInventory("DarkPowerAmmo",1)
TNT1 A 0 A_GiveInventory("EdgeBurstCharge",1)
stop
}
}

actor CutSelfOnEdge : CustomInventory
{
states
{
Pickup:
TNT1 A 0 A_JumpIfHealthLower(2,"PinchPickup")
TNT1 A 0 A_ChangeFlag("NOPAIN",1)
TNT1 A 0 SetPlayerProperty(0, 1, 16)
TNT1 A 0 DamageThing(1)
TNT1 A 0 A_ChangeFlag("NOPAIN",0)
TNT1 A 0 SetPlayerProperty(0, 0, 16)
stop
PinchPickup:
TNT1 A 0 A_JumpIfInventory("EdgeBurstCharge",BURST_MIN_CHARGE,"PickupNo")
TNT1 A 0 A_GiveInventory("DarkPowerAmmo",1)
stop
PickupNo:
TNT1 A 0
stop
}
}

actor EdgeBurstCooldownPickup : CustomInventory
{
states
{
Pickup:
TNT1 A 0 A_TakeInventory("DarkPowerLockout",1)
TNT1 A 0 A_TakeInventory("EdgeBurstCooldown",1)
stop
}
}

actor PowerUseEdgeBurstGiver : PowerupGiver
{
+INVENTORY.AUTOACTIVATE
+INVENTORY.ALWAYSPICKUP
//Inventory.MaxAmount 0
Powerup.Type "PowerUseEdgeBurst"
Powerup.Duration 20
}

actor PowerUseEdgeBurst : Powerup
{
Powerup.duration 20
}

actor EdgeBurstIsCharging : Inventory
{
inventory.amount 1
inventory.maxamount 1
}

actor TeleportsBehindYouSubAmmo : Inventory
{
inventory.amount 1
inventory.maxamount 10
}

actor TeleportsBehindYouAmmo : Ammo
{
+INVENTORY.IGNORESKILL
inventory.amount 1
inventory.maxamount 28
}

actor DarkPowerAmmo : Ammo
{
+INVENTORY.IGNORESKILL
inventory.amount 1
inventory.maxamount 100
}

actor EdgeBurstCharge : Inventory
{
inventory.amount 1
inventory.maxamount 100
}
actor EdgeBurstCooldown : Inventory
{
inventory.amount 1
inventory.maxamount 100
}

actor DarkPowerLockout : Inventory
{
inventory.amount 1
inventory.maxamount 10
}