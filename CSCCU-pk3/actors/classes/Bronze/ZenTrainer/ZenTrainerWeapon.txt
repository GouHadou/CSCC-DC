const int ZEN_ARANGE = 512;
const int ZEN_ARANGEX = 768;

actor ZenTrainerWep : Weapon
{
dropitem ""
Weapon.AmmoUse 0
Weapon.AmmoUse2 2
Inventory.Pickupmessage "Oh noes"
Obituary "%o's mind was freed from %k's control, but died afterwards."
weapon.ammotype "ZenTrainerAmmo1"
weapon.ammotype2 "ZenTrainerAmmo1"
+WEAPON.NOAUTOAIM
+WEAPON.AMMO_OPTIONAL
+WEAPON.ALT_AMMO_OPTIONAL
+WEAPON.ALT_USES_BOTH
+WEAPON.DONTBOB
+WEAPON.ALLOW_WITH_RESPAWN_INVUL
States
{
Spawn:
TNT1 A 1
stop
/*
Deselect:
TNT1 A 0
goto DeselectX
Select:
TNT1 A 0
goto SelectX
*/


Deselect:
TNT1 AAAAAAAAAAAAAAAAAAAAAA 0 A_Lower
ZNTN A 1 A_Lower
Loop
Select:
TNT1 AAAAAAAAAAAAAAAAAAAAAA 0 A_Raise
ZNTN A 1 A_Raise
Loop

Ready:
TNT1 A 0 
ZNTN A 0 ACS_ExecuteAlways(998,0,DYE_STARMAN,1)
ZNTN A 0 A_GunFlash("Flash")
goto Ready2
Ready2:
ZNTN A 0 A_JumpIfInventory("ZenTrainerAmmo1",0,"Ready2X")
ZNTN A 2 A_WeaponReady(WRF_NOSECONDARY)
loop
Ready2X:
ZNTN A 2 A_WeaponReady
ZNTN A 0 A_JumpIfInventory("ZenTrainerAmmo1",0,"Ready2X")
goto Ready2

Flash:
TNT1 A 1
TNT1 A 0 A_GiveInventory("ZenTrainerAmmo1",4)
TNT1 A 0 A_JumpIfInventory("IsDead",1,"NoFlash")
TNT1 A 0 A_JumpIfInventory("AuraFlag_heal",1,"HealAura")
TNT1 A 0 A_JumpIfInventory("AuraFlag_power",1,"PowerAura")
TNT1 A 0 A_JumpIfInventory("AuraFlag_defense",1,"DefenseAura")
TNT1 A 0 A_JumpIfInventory("AuraFlag_haste",1,"HasteAura")
//TNT1 A 0 A_JumpIfInventory("AuraFlag_rage",1,"RageAura")
loop
HealAura:
TNT1 A 0 ACS_NamedExecuteAlways("RadiusGiveSQ",0,9,ZEN_ARANGE,1)
TNT1 AAAAA 2 A_SpawnItemEx("ZNAura_Heal",ZEN_ARANGE,0,0,0,0,8,random(0,360),1)
goto Flash
PowerAura:
TNT1 A 0 ACS_NamedExecuteAlways("RadiusGiveSQ",0,10,ZEN_ARANGE,1)
TNT1 AAAAA 2 A_SpawnItemEx("ZNAura_Attack",ZEN_ARANGE,0,0,0,0,8,random(0,360),1)
goto Flash
DefenseAura:
TNT1 A 0 ACS_NamedExecuteAlways("RadiusGiveSQ",0,11,ZEN_ARANGE,1)
TNT1 AAAAA 2 A_SpawnItemEx("ZNAura_Defense",ZEN_ARANGE,0,0,0,0,8,random(0,360),1)
goto Flash
HasteAura:
TNT1 A 0 ACS_NamedExecuteAlways("RadiusGiveSQ",0,12,ZEN_ARANGE,1)
TNT1 AAAAA 2 A_SpawnItemEx("ZNAura_Haste",ZEN_ARANGE,0,0,0,0,8,random(0,360),1)
goto Flash
RageAura:
TNT1 A 0 ACS_NamedExecuteAlways("RadiusGiveSQ",0,13,ZEN_ARANGE,1)
TNT1 AAAAA 2 A_SpawnItemEx("ZNAura_Rage",ZEN_ARANGE,0,0,0,0,8,random(0,360),1)
goto Flash

AltFlash:
TNT1 A 1
TNT1 A 0 A_JumpIfInventory("IsDead",1,"NoFlash")
TNT1 A 0 A_JumpIfInventory("AuraFlag_heal",1,"HealAuraEX")
TNT1 A 0 A_JumpIfInventory("AuraFlag_power",1,"PowerAuraEX")
TNT1 A 0 A_JumpIfInventory("AuraFlag_defense",1,"DefenseAuraEX")
TNT1 A 0 A_JumpIfInventory("AuraFlag_haste",1,"HasteAuraEX")
//TNT1 A 0 A_JumpIfInventory("AuraFlag_rage",1,"RageAuraEX")
stop
HealAuraEX:
TNT1 A 0 ACS_NamedExecuteAlways("RadiusGiveSQ",0,14,ZEN_ARANGEX,1)
TNT1 A 0 A_SpawnItemEx("ZNAura_Heal",ZEN_ARANGEX,0,0,0,0,8,random(0,360),1)
TNT1 AAA 0 A_SpawnItemEx("ZNAura_Heal",0,0,64,random(2,4),0,4,random(0,360),1)
goto AltFlashEnd
PowerAuraEX:
TNT1 A 0 ACS_NamedExecuteAlways("RadiusGiveSQ",0,15,ZEN_ARANGEX,1)
TNT1 A 0 A_SpawnItemEx("ZNAura_Attack",ZEN_ARANGEX,0,0,0,0,8,random(0,360),1)
TNT1 AAA 0 A_SpawnItemEx("ZNAura_Attack",0,0,64,random(2,4),0,4,random(0,360),1)
goto AltFlashEnd
DefenseAuraEX:
TNT1 A 0 ACS_NamedExecuteAlways("RadiusGiveSQ",0,16,ZEN_ARANGEX,1)
TNT1 A 0 A_SpawnItemEx("ZNAura_Defense",ZEN_ARANGEX,0,0,0,0,8,random(0,360),1)
TNT1 AAA 0 A_SpawnItemEx("ZNAura_Defense",0,0,64,random(2,4),0,4,random(0,360),1)
goto AltFlashEnd
HasteAuraEX:
TNT1 A 0 ACS_NamedExecuteAlways("RadiusGiveSQ",0,17,ZEN_ARANGEX,1)
TNT1 A 0 A_SpawnItemEx("ZNAura_Haste",ZEN_ARANGEX,0,0,0,0,8,random(0,360),1)
TNT1 AAA 0 A_SpawnItemEx("ZNAura_Haste",0,0,64,random(2,4),0,4,random(0,360),1)
goto AltFlashEnd
RageAuraEX:
TNT1 A 0 ACS_NamedExecuteAlways("RadiusGiveSQ",0,10,ZEN_ARANGEX,1)
TNT1 A 0 A_SpawnItemEx("ZNAura_Rage",ZEN_ARANGEX,0,0,0,0,8,random(0,360),1)
TNT1 AAA 0 A_SpawnItemEx("ZNAura_Rage",0,0,64,random(2,4),0,4,random(0,360),1)
goto AltFlashEnd

AltFlashEnd:
TNT1 A 2
TNT1 A 0 A_TakeInventory("ZenTrainerAmmo1",1)
TNT1 A 0 A_JumpIfInventory("ZenTrainerAmmo1",1,"AltFlash")
TNT1 A 0 A_GunFlash("Flash")
stop

NoFlash:
TNT1 A 0
stop

Fire:
ZNTN B 1
ZNTN B 0 A_FireCustomMissile("ZTPsychicBall",0,0,8)
ZNTN CD 2
ZNTN D 0 A_Refire
ZNTN DDCCBBBA 2
Goto Ready2
Hold:
ZNTN R 2 A_GiveInventory("PsychicBallHold")
ZNTN R 0 A_Refire(1)
goto HoldEnd
ZNTN Q 2 A_GiveInventory("PsychicBallHold")
ZNTN Q 0 A_Refire(1)
goto HoldEnd
ZNTN P 2 A_GiveInventory("PsychicBallHold")
ZNTN P 0 A_Refire(1)
goto HoldEnd
ZNTN O 2 A_GiveInventory("PsychicBallHold")
ZNTN O 0 A_Refire(1)
goto HoldEnd
ZNTN N 2 A_GiveInventory("PsychicBallHold")
ZNTN N 0 A_Refire(1)
goto HoldEnd
ZNTN M 2 A_GiveInventory("PsychicBallHold")
ZNTN M 0 A_Refire(1)
goto HoldEnd
ZNTN M 2 A_GiveInventory("PsychicBallHold")
ZNTN M 0 A_Refire(1)
goto HoldEnd
ZNTN N 2 A_GiveInventory("PsychicBallHold")
ZNTN N 0 A_Refire(1)
goto HoldEnd
ZNTN O 2 A_GiveInventory("PsychicBallHold")
ZNTN O 0 A_Refire(1)
goto HoldEnd
ZNTN P 2 A_GiveInventory("PsychicBallHold")
ZNTN P 0 A_Refire(1)
goto HoldEnd
ZNTN Q 2 A_GiveInventory("PsychicBallHold")
ZNTN Q 0 A_Refire(1)
goto HoldEnd
ZNTN R 2 A_GiveInventory("PsychicBallHold")
ZNTN R 0 A_Refire(1)
goto HoldEnd
ZNTN D 2 A_GiveInventory("PsychicBallHold")
ZNTN D 0 A_Refire("Hold")
goto HoldEnd

HoldEnd:
ZNTN DDCCBBBA 2 A_TakeInventory("PsychicBallHold",999)
goto Ready2

AltFire:
ZNTN E 0 A_JumpIfNoAmmo("NoAmmo")
ZNTN E 0 A_GunFlash("AltFlash")
ZNTN EFGHIII 2
ZNTN E 0 A_PlaySoundEx("weapon/thunderbolt","Weapon")
ZNTN IHGFE 2
goto Ready2

NoAmmo:
ZNTN A 1
goto Ready2
}
}

actor ZenTrainerAmmo1 : Ammo
{
inventory.maxamount 140
inventory.amount 1
+INVENTORY.IGNORESKILL
}

actor ZenTrainerAuraDelay : Powerup {powerup.duration 50}

actor BFlag : Inventory {inventory.maxamount 1}

actor PsychicBallHold : BFlag {}
actor ZenAltFlashFlag : BFlag {}

actor AuraFlag_heal : BFlag {}
actor AuraFlag_power : BFlag {}
actor AuraFlag_defense : BFlag {}
actor AuraFlag_haste : BFlag {}
actor AuraFlag_rage : BFlag {}

actor AuraSwitchItem : CustomInventory
{
inventory.amount 1
inventory.maxamount 1
inventory.icon "ClouIcon"
scale 2.0
inventory.pickupmessage "This just in, a high chance of thunder storms today."
+INVBAR
states
{
Use:
TNT1 A 0
TNT1 A 0 A_JumpIfInventory("ZenTrainerAuraDelay",1,"nope")
TNT1 A 0 A_GiveInventory("ZenTrainerAuraDelay")
TNT1 A 0 A_JumpIfInventory("AuraFlag_heal",1,"TakeHealGivePower")
TNT1 A 0 A_JumpIfInventory("AuraFlag_power",1,"TakePowerGiveDefense")
TNT1 A 0 A_JumpIfInventory("AuraFlag_defense",1,"TakeDefenseGiveHaste")
TNT1 A 0 A_JumpIfInventory("AuraFlag_haste",1,"TakeHasteGiveHeal")
TNT1 A 0 //A_JumpIfInventory("AuraFlag_rage",1,"TakeRageGiveHeal")
fail
TakeHealGivePower:
TNT1 A 0 A_TakeInventory("AuraFlag_heal")
TNT1 A 0 A_GiveInventory("AuraFlag_power")
fail
TakePowerGiveDefense:
TNT1 A 0 A_TakeInventory("AuraFlag_power")
TNT1 A 0 A_GiveInventory("AuraFlag_defense")
fail
TakeDefenseGiveHaste:
TNT1 A 0 A_TakeInventory("AuraFlag_defense")
TNT1 A 0 A_GiveInventory("AuraFlag_haste")
fail
TakeHasteGiveHeal:
TNT1 A 0 A_TakeInventory("AuraFlag_haste")
TNT1 A 0 A_GiveInventory("AuraFlag_heal")
fail
nope:
TNT1 A 0
fail
/*TakeHasteGiveRage:
TNT1 A 0 A_TakeInventory("AuraFlag_haste")
TNT1 A 0 A_GiveInventory("AuraFlag_rage")
fail
TakeRageGiveHeal:
TNT1 A 0 A_TakeInventory("AuraFlag_rage")
TNT1 A 0 A_GiveInventory("AuraFlag_heal")
fail*/
}
}

actor ZTPsychicBall
{
PROJECTILE
Translation "192:192=228:228","198:198=229:229","0:0=167:167"
Obituary "%o couldn't get %k off %p mind."
DamageType "ZTPsychicBall"
Radius 12
Height 12
scale 2.5
speed 45
Damage (8)
+HITTRACER
+HEXENBOUNCE
+NOTARGETSWITCH
+SKYEXPLODE
+CANBOUNCEWATER
+FORCEXYBILLBOARD
States
{
Spawn:
TNT1 A 0
TNT1 A 0 A_PlaySoundEx("weapon/blackholebomb","Weapon",1)
BLKH BCDEBCDEBC 1 A_SpawnItemEx("ZTPsychicBallGFX2",0,random(-6,6),random(-6,6),0,0,0,0,1)
SpawnC:
BLKH BCDEBCDEBCDEBCDEBCDE 1 A_ScaleVelocity(0.05)
SpawnC2:
BLKH BCDE 2 A_PlaySoundEx("weapon/blackholebomb","Weapon",1)
BLKH B 0 A_SpawnItemEx("ZTPsychicBallGFX",0,0,0,0,0,0,0,1)
BLKH B 0 A_JumpIfInTargetInventory("PsychicBallHold",1,"SpawnC2")
stop
Crash:XDeath:Death:
TNT1 A 0 A_Warp(AAPTR_Tracer,0,0,0,0,WARPF_NoCheckPosition,"Exploding")
stop
Exploding:
TNT1 A 0 A_JumpIfInTargetInventory("IsDead",1,"StopNow")
BLKH B 0 A_JumpIfInTargetInventory("PsychicBallHold",1,"DistanceChecker")
stop
DistanceChecker:
TNT1 A 0 A_JumpIfInTargetInventory("IsDead",1,"StopNow")
BLKH B 0 A_JumpIfCloser(1024,"Explodenow")
stop
Explodenow:
TNT1 A 0 A_JumpIfInTargetInventory("IsDead",1,"StopNow")
TNT1 A 0 A_Warp(AAPTR_Tracer,0,0,0,0,WARPF_NoCheckPosition)
TNT1 A 0 A_JumpIfInventory("IsDead",1,"StopNow",AAPTR_Tracer)
TNT1 A 0 A_PlaySoundEx("weapon/blackholebombdetonate", "body", 1)
TNT1 AAAAAAAA 0 A_SpawnItemEx("ZTPsychicBallGFX2",32,0,random(0,40),random(6,12),0,random(-6,6),random(0,360),1)
TNT1 A 0 A_Explode(10,64,0,0,42)
TNT1 A 0 A_JumpIfInventory("IsDead",1,"StopNow",AAPTR_Tracer)
TNT1 A 0 A_Warp(AAPTR_Tracer,0,0,0,0,WARPF_NoCheckPosition)
TNT1 A 7 A_SpawnItemEx("ZTPsychicBallGFX2",32,0,random(0,40),0,0,8,random(0,360),1)
TNT1 A 0 A_Warp(AAPTR_Tracer,0,0,0,0,WARPF_NoCheckPosition)
TNT1 A 0 A_StopSoundEx("Body")
TNT1 A 0 A_JumpIfInventory("IsDead",1,"StopNow",AAPTR_Tracer)
TNT1 A 7 A_SpawnItemEx("ZTPsychicBallGFX2",32,0,random(0,40),0,0,0,random(0,360),1)
TNT1 A 0 A_Warp(AAPTR_Tracer,0,0,0,0,WARPF_NoCheckPosition)
TNT1 A 0 A_JumpIfInventory("IsDead",1,"StopNow",AAPTR_Tracer)
TNT1 A 7 A_SpawnItemEx("ZTPsychicBallGFX2",32,0,random(0,40),0,0,0,random(0,360),1)
TNT1 A 0 A_Warp(AAPTR_Tracer,0,0,0,0,WARPF_NoCheckPosition)
TNT1 A 0 A_JumpIfInventory("IsDead",1,"StopNow",AAPTR_Tracer)
TNT1 A 7 A_SpawnItemEx("ZTPsychicBallGFX2",32,0,random(0,40),0,0,0,random(0,360),1)
TNT1 A 0 A_Warp(AAPTR_Tracer,0,0,0,0,WARPF_NoCheckPosition)
TNT1 A 0 A_JumpIfInventory("IsDead",1,"StopNow",AAPTR_Tracer)
TNT1 A 7 A_SpawnItemEx("ZTPsychicBallGFX2",32,0,random(0,40),0,0,0,random(0,360),1)
TNT1 A 0 A_Warp(AAPTR_Tracer,0,0,0,0,WARPF_NoCheckPosition)
TNT1 A 0 A_JumpIfInventory("IsDead",1,"StopNow",AAPTR_Tracer)
TNT1 A 7 A_SpawnItemEx("ZTPsychicBallGFX2",32,0,random(0,40),0,0,0,random(0,360),1)
TNT1 A 0 A_Warp(AAPTR_Tracer,0,0,0,0,WARPF_NoCheckPosition)
TNT1 A 0 A_JumpIfInventory("IsDead",1,"StopNow",AAPTR_Tracer)
TNT1 A 7 A_SpawnItemEx("ZTPsychicBallGFX2",32,0,random(0,40),0,0,0,random(0,360),1)
goto Exploding
StopNow:
TNT1 A 0
stop
}
}

actor ZTPsychicBallGFX : BasicClientside {
+FORCEXYBILLBOARD
Translation "192:192=228:228","198:198=229:229","0:0=167:167"
renderstyle add
scale 2.5
States
{
Spawn:
TNT1 A 0
BLKH B 2 A_SetScale(ScaleX + 0.235)
BLKH B 0 A_Fadeout
BLKH C 2 A_SetScale(ScaleX + 0.235)
BLKH C 0 A_Fadeout
BLKH D 2 A_SetScale(ScaleX + 0.235)
BLKH D 0 A_Fadeout
BLKH E 2 A_SetScale(ScaleX + 0.235)
BLKH E 0 A_Fadeout
loop
}
}

actor ZTPsychicBallGFX2 : BasicClientside {
+FORCEXYBILLBOARD
Translation "192:192=228:228","198:198=229:229","0:0=167:167"
scale 4
Renderstyle translucent
Alpha 0.75
States
{
Spawn:
TNT1 A 0
BLKH TTTSSSRRR 1
stop
}
}

actor ZNAura_Attack : BasicClientside
{
Scale 2.65
States
{
Spawn:
TNT1 A 0
ZNAT A 2 A_Fadeout
loop
}
}

actor ZNAura_Heal : BasicClientside
{
Scale 2.65
States
{
Spawn:
TNT1 A 0
ZNHL A 2 A_Fadeout
loop
}
}

actor ZNAura_Defense : BasicClientside
{
Scale 2.65
States
{
Spawn:
TNT1 A 0
ZNDF A 2 A_Fadeout
loop
}
}

actor ZNAura_Haste : BasicClientside
{
Scale 2.65
States
{
Spawn:
TNT1 A 0
ZNHS A 2 A_Fadeout
loop
}
}

actor ZNAura_Rage : BasicClientside
{
Scale 2.65
States
{
Spawn:
TNT1 A 0
ZNRG A 2 A_Fadeout
loop
}
}

// ============ Powerup auras
actor Zen_Heal1 : Powerup{powerup.duration 2}
actor Zen_Heal2 : Powerup{powerup.duration 2}
actor Zen_Heal1PU : Powerup {powerup.duration 35}
actor Zen_Heal2PU : Powerup {powerup.duration 35}


actor Zen_Power150 : PowerDamage
{
powerup.duration 35
damagefactor "normal", 1.50
}

actor Zen_Power200 : PowerDamage
{
powerup.duration 35
damagefactor "normal", 2
}

actor Zen_Defense150 : PowerProtection
{
powerup.duration 35
damagefactor "normal", 0.75
}

actor Zen_Defense200 : PowerProtection
{
powerup.duration 35
damagefactor "normal", 0.25
}

actor Zen_Haste110 : Powerspeed
{
+POWERSPEED.NOTRAIL
powerup.duration 35
speed 1.15
}
actor Zen_Haste125 : Powerspeed
{
powerup.duration 35
speed 1.35
}

actor Zen_Rage : PowerDoubleFiringSpeed {powerup.duration 35}
