//+[==EXECUTE LV 1==]+

actor ExecuteTech1 : CrazyWaveBoss
{
Weapon.AmmoUse 1
Weapon.SlotNumber 2
Obituary "%o was demolished by %k's Insanity Tech: \ccExecute \c[w5]LV 1\c-."
Tag "$TAG_EXECUTE1"
inventory.icon "EXECB0"
States
{
Deselect:
TNT1 AAAAAAAAAAAAAAAAAAAAAA 0 A_Lower
IPID A 1 A_Lower
Loop
Select:
TNT1 AAAAAAAAAAAAAAAAAAAAAA 0 A_Raise
IPID A 1 A_Raise
Loop

//+[== SELL THE TECH ==]+

Altfire:
IPID A 1
IPID A 0
Althold:
IPID A 1 A_JumpIfInventory("SellCharge",100,"SellTech")
IPID A 0 A_GiveInventory("SellCharge",5)
IPID A 0 A_Refire
Goto Ready1
SellTech:
IPID A 0 A_SpawnItemEx("SellFX_Helper")
IPID A 1 Offset(0,25)
IPID A 1 Offset(0,50) A_PlaySoundEx("insanitytech/sell1","Weapon")
IPID A 1 Offset(0,75)
IPID A 1 Offset(0,100) A_GiveInventory("TechAmmo",25)
IPID A 10
IPID A 0 A_JumpIfInventory("ExecuteAmmo1",2,"SellTechX")
IPID A 0 A_TakeInventory("ExecuteAmmo1",99)
IPID A 0 A_TakeInventory("ExecuteTech1",99)
Goto Ready1
SellTechX:
IPID A 0 A_TakeInventory("ExecuteAmmo1",1)
Goto Ready1

//+[== USE THE TECH ==]+

Fire: //Start
ExecuteStart:
IPID A 0 ACS_ExecuteAlways(512,0,1,0)
PEXC IIHH 1
IPID A 0 A_PlaySoundEx("Execute/Charge","Weapon")
ExecuteCharge:
TNT1 A 0 A_GiveInventory("ExecuteWeakness1",1)
IPID A 0 A_GunFlash
IPID A 0 ACS_ExecuteAlways(512,0,1,2)
PEXC FJ 1 A_FireCustomMissile("ExecuteChecker",0,0,8,0)
TNT1 A 0 A_SpawnItemEx("ExecuteRange1",48,0,8,momx,momy,momz,0,SXF_ABSOLUTEMOMENTUM,0)
PEXC G 0 A_Refire("ExecuteCharge")
ExecuteCheck:
PEXC G 1 A_JumpIfInventory("CanExecute",1,"ExecuteFire")
Goto ExecuteFail
ExecuteFire:
TNT1 A 0 A_TakeInventory("ExecuteWeakness1",1)
IPID A 0 A_TakeInventory("ExecuteAmmo1",1)
PEXC H 0 A_SpawnItemEx("ExecuteFinisher1",48,0,8)
PEXC G 1 Offset(-48,64)
PEXC G 11 Offset(0,96)
PEXC G 3 Offset(0,128)
IPID A 1 Offset(0,92)
IPID A 1 Offset(0,62)
IPID A 1 A_WeaponReady(WRF_NOFIRE)
IPID A 3
IPID A 0 ACS_ExecuteAlways(991,0,DYE_PHARAOHMAN)
IPID A 0 A_TakeInventory("CanExecute",99)
TakeAll:
IPID A 0 A_JumpIfInventory("ExecuteAmmo1",1,"Ready1")
IPID A 0 A_TakeInventory("ExecuteTech1",99)
IPID A 0
Goto Ready1
ExecuteFail:
TNT1 A 0 A_TakeInventory("ExecuteWeakness1",1)
PEXC G 0 ACS_ExecuteAlways(991,0,DYE_PHARAOHMAN)
PEXC G 0 ACS_ExecuteAlways(512,0,1,0)
IPID A 0 A_TakeInventory("CanExecute",99)
PEXC E 1 Offset(-24,42)
PEXC E 1 Offset(-24,72)
PEXC E 1 Offset(-24,92)
PEXC E 1 Offset(-24,102)
PEXC E 1 Offset(-24,142)
IPID A 1 Offset(0,92)
IPID A 1 Offset(0,62)
IPID A 1 A_WeaponReady(WRF_NOFIRE)
IPID A 3
goto Ready1
Flash:
IPID A 0 A_JumpIfInventory("ExecuteWeakness1",1,"Flash_Execute")
TNT1 A 1
loop
Flash_Execute:
TNT1 A 1 ACS_ExecuteAlways(991,0,DYE_PHARAOHEXECUTE1)
TNT1 A 1 ACS_ExecuteAlways(991,0,DYE_PHARAOHMAN)
Goto Flash
}
}

Actor ExecuteChecker
{
PROJECTILE
+MTHRUSPECIES
+DONTBLAST
+THRUGHOST
Obituary "%o fainted from %k's cold grip."
Damage(1)
Radius 55
Height 75
Speed 20
Damagetype "ExecuteCheck"
Scale 1.0
States
{
Spawn:
MEGA A 0
MEGA A 2
stop
}
}

Actor ExecuteFinisher1
{
PROJECTILE
+DONTBLAST
+THRUGHOST
+NOCLIP
+PIERCEARMOR
Damagetype "ExecuteFinish1"
Scale 1.5
Radius 60
Height 75
Damage(0)
Speed 0
Obituary "%o was demolished by %k's Insanity Tech: \ccExecute \c[w5]LV 1\c-."
States
{
Spawn:
TNT1 A 0 Radius_Quake(4,45,0,1,0)
TNT1 A 0 A_SpawnItemEx("ExecuteFX",15,-10,25)
TNT1 A 0 A_PlaySoundEx("Execute/Finish","Voice")
TNT1 A 1 A_Explode(40,55,0,0,55)
stop
}
}

Actor ExecuteFX
{
Translation "192:192=107:107", "198:198=110:110", "4:4=101:101"
+SKYEXPLODE
+DONTBLAST
+DONTREFLECT
+DONTSPLASH
+NOGRAVITY
-SOLID
+THRUGHOST
+THRUACTORS
+NOINTERACTION
Scale 0.6
Radius 4
Height 4
States
{
Spawn:
PEXF A 0
PFBX ABCDEFGHI 1 bright
PFBX IIII 1 bright A_Fadeout
stop
}
}

Actor ExecuteRange1 : ExecuteFX
{
+NOCLIP
Translation "0:255=109:109"
renderstyle add
alpha 0.5
Scale 3
States
{
Spawn:
MMFX F 0
MMFX F 1
stop
}
}

actor ExecuteAmmo1 : Ammo
{
inventory.amount 4
inventory.maxamount 4
}

actor ExecuteFlag : Inventory{}

Actor ExecuteFinishProtect : PowerProtection //Protection from taking explosion damage from Execute finish twice
{
PowerUp.Duration 20 
DamageFactor "ExecuteFinish1", 0.0
DamageFactor "ExecuteFinish2", 0.0
DamageFactor "ExecuteFinish3", 0.0
}

Actor CanExecute : Powerup
{
inventory.amount 1 
inventory.maxamount 1 
+INVENTORY.IGNORESKILL
PowerUp.Duration 2 
}

actor ExecuteWeakness1 : PowerProtection
{
Powerup.Duration 0x7FFFFFFD
damagefactor "Normal", 1.6
}